import{m as _e,i as N,v as de,l as y,y as le,x as ee,j as Z,a as pe,r as O,b as l,g as k,w,e as f,t as C,u as V,d as _,p as v,z as me,A as fe,h as ve,c as m,F as be,n as te,q as ge,B as j}from"./index-8ca2d158.js";import{_ as ye,a as ke}from"./ViewControls-5fb3bbce.js";import{s as ne,_ as xe}from"./statuses-6fc48ca5.js";import{_ as we}from"./CustomActions-d5b79d4f.js";import{E as he}from"./EmailAtIcon-8000a63d.js";import{P as Ce}from"./PhoneIcon-42af6989.js";import{_ as Ve,N as se}from"./NoteModal-6fe04093.js";import{T as ae}from"./TaskIcon-1948830b.js";import{C as Ee}from"./CommentIcon-0a334634.js";import{I as J}from"./IndicatorIcon-367a8d49.js";import{O as Me}from"./OpportunitiesIcon-89f01f41.js";import{_ as $e}from"./LayoutHeader-72a3cdee.js";import{_ as Oe}from"./OpportunitiesListView-bab2c24d.js";import{_ as Ue}from"./KanbanView-a59f86e9.js";import{E as Se}from"./views-5d4a0486.js";import{F as Ie}from"./Fields-02fbbc9b.js";import{u as ue,g as Te,w as ze,h as Ae,t as H,d as X,f as De,b as P,_ as oe,c as Y}from"./index-b1bb6af7.js";import{_ as qe}from"./Switch.vue_vue_type_script_setup_true_lang-cbc97d13.js";import{T as Re}from"./TaskModal-9393661c.js";import{_ as Le}from"./QuickEntryModal-ebc5f118.js";import{c as Be}from"./customers-8d8733e3.js";import{c as je}from"./settings-9f3d7d3a.js";import{_ as Pe}from"./Dropdown.vue_vue_type_script_setup_true_lang-dba778cd.js";import"./FadedScrollableDiv-10ee6cf2.js";import"./IconPicker-b2d84813.js";import"./DatePicker-0e72d67e.js";import"./PinIcon-0747ea14.js";import"./DetailsIcon-14f9b41c.js";import"./DragVerticalIcon-523c4542.js";import"./ArrowUpRightIcon-c299f2a1.js";import"./ListBulkActions-ccdc1c2a.js";import"./AssignmentModal-759f92c3.js";import"./ListRows-7339a2c3.js";import"./ListFooter-ed664a38.js";const Qe={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},Ke={class:"mb-5 flex items-center justify-between"},We={class:"text-2xl font-semibold leading-6 text-gray-900"},Ge={class:"flex items-center gap-1"},Je={class:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3"},He={class:"flex items-center gap-3 text-sm text-gray-600"},Xe={class:"px-4 pb-7 pt-4 sm:px-6"},Ye={class:"flex flex-row-reverse gap-2"},Ze={__name:"OpportunityModal",props:_e({defaults:Object},{modelValue:{},modelModifiers:{},quickEntry:{},quickEntryModifiers:{}}),emits:["update:modelValue","update:quickEntry"],setup(R){const Q=R,{getUser:U,isManager:K}=ue(),{getDealStatus:L,statusOptions:A}=ne(),E=N(R,"modelValue"),M=de(),b=y(null),i=le({customer:"",customer_name:"",website:"",no_of_employees:"",territory:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",opportunity_owner:"",lead:"",opportunity_amount:""}),u=y(!1),$=y(!1),D=ee({url:"next_crm.ncrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["quickEntryFields","Opportunity"],params:{doctype:"Opportunity",type:"Quick Entry"},auto:!0,transform:d=>d.forEach(g=>{g.fields.forEach(p=>{p.name=="status"?(p.type="Select",p.options=h.value,p.prefix=L(i.status).iconColorClass):p.name=="opportunity_owner"&&(p.type="User")})})}),S=Z(()=>{let d=D.data||[];if(!d.length)return[];let g=[];return $.value?g.push(d.find(p=>p.label==="Select Customer")):g.push(d.find(p=>p.label==="Customer Details")),g.push(d.find(p=>p.label==="Select Contact")),d.forEach(p=>{["Select Customer","Customer Details","Select Contact"].includes(p.label)||g.push(p)}),g}),h=Z(()=>{let d=A("deal");return i.status||(i.status=d[0].value),d});function o(){i.website&&!i.website.startsWith("http")&&(i.website="https://"+i.website),ee({url:"next_crm.overrides.opportunity.create_opportunity",params:{args:i},auto:!0,validate(){if(b.value=null,i.opportunity_amount&&(i.opportunity_amount=i.opportunity_amount.replace(/,/g,""),isNaN(i.opportunity_amount)))return b.value=__("Annual Revenue should be a number"),b.value;if(i.mobile_no&&isNaN(i.mobile_no.replace(/[-+() ]/g,"")))return b.value=__("Mobile No should be a number"),b.value;if(i.email&&!i.email.includes("@"))return b.value=__("Invalid Email"),b.value;if(!i.status)return b.value=__("Status is required"),b.value;u.value=!0},onSuccess(d){me("opportunity_created"),u.value=!1,E.value=!1,M.push({name:"Opportunity",params:{opportunityId:d}})},onError(d){if(u.value=!1,!d.messages){b.value=d.message;return}b.value=d.messages.join(`
`)}})}const q=N(R,"quickEntry");function W(){q.value=!0,fe(()=>{E.value=!1})}return pe(()=>{Object.assign(i,Q.defaults),i.opportunity_owner||(i.opportunity_owner=U().name),!i.status&&h.value[0].value&&(i.status=h.value[0].value)}),(d,g)=>{const p=O("Button"),G=O("FeatherIcon"),I=O("ErrorMessage"),T=O("Dialog");return l(),k(T,{modelValue:E.value,"onUpdate:modelValue":g[2]||(g[2]=z=>E.value=z),options:{size:"3xl"}},{body:w(()=>[f("div",Qe,[f("div",Ke,[f("div",null,[f("h3",We,C(d.__("Create Opportunity")),1)]),f("div",Ge,[V(K)()?(l(),k(p,{key:0,variant:"ghost",class:"w-7",onClick:W},{default:w(()=>[_(Se,{class:"h-4 w-4"})]),_:1})):v("",!0),_(p,{variant:"ghost",class:"w-7",onClick:g[0]||(g[0]=z=>E.value=!1)},{default:w(()=>[_(G,{name:"x",class:"h-4 w-4"})]),_:1})])]),f("div",null,[f("div",Je,[f("div",He,[f("div",null,C(d.__("Choose Existing Customer")),1),_(V(qe),{modelValue:$.value,"onUpdate:modelValue":g[1]||(g[1]=z=>$.value=z)},null,8,["modelValue"])])]),S.value?(l(),k(Ie,{key:0,class:"border-t pt-4",sections:S.value,data:i},null,8,["sections","data"])):v("",!0),b.value?(l(),k(I,{key:1,class:"mt-4",message:d.__(b.value)},null,8,["message"])):v("",!0)])]),f("div",Xe,[f("div",Ye,[_(p,{variant:"solid",label:d.__("Create"),loading:u.value,onClick:o},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}},Fe={class:"flex gap-2 items-center"},Ne={key:0},et={key:1},tt={key:2},st={key:3,class:"truncate text-base"},at={key:4,class:"truncate text-base"},ot={key:5,class:"truncate text-base"},lt={key:6,class:"text-gray-500"},nt={key:0,class:"truncate flex items-center gap-2"},ut={key:0},rt={key:1},it={key:2},ct={key:3,class:"truncate text-base"},_t={key:4,class:"truncate text-base"},dt={key:5,class:"flex items-center"},pt={key:6,class:"truncate text-base"},mt={class:"flex gap-2 items-center justify-between"},ft={class:"text-gray-600 flex items-center gap-1.5"},vt={key:0},bt=f("span",{class:"text-3xl leading-[0]"}," · ",-1),gt={key:1},yt=f("span",{class:"text-3xl leading-[0]"}," · ",-1),kt={key:2},xt=f("span",{class:"text-3xl leading-[0]"}," · ",-1),wt={key:3},ht={key:2,class:"flex h-full items-center justify-center"},Ct={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},ls={__name:"Opportunities",setup(R){const{makeCall:Q}=Te(),{getUser:U}=ue(),{getCustomer:K}=Be(),{getDealStatus:L}=ne(),A=ve(),E=y(null),M=y(!1),b=y(!1),i=le({}),u=y({}),$=y(1),D=y(1),S=y(20),h=y(null);function o(r,t){var a;function n(c){return c&&typeof c=="object"&&!Array.isArray(c)?c:{label:c}}return n((a=q.value)==null?void 0:a.find(c=>c.name==r)[t])}const q=Z(()=>{var r,t,n,a,c,e,s;return(t=(r=u.value)==null?void 0:r.data)!=null&&t.data?u.value.data.view_type==="group_by"?(a=(n=u.value)==null?void 0:n.data.group_by_field)!=null&&a.name?W((c=u.value)==null?void 0:c.data.data,(e=u.value)==null?void 0:e.data.group_by_field):[]:u.value.data.view_type==="kanban"?d(u.value.data.data):g((s=u.value)==null?void 0:s.data.data):[]});function W(r,t){var a;let n=[];return(a=t.options)==null||a.forEach(c=>{let e=[];c?e=r.filter(x=>x[t.name]==c):e=r.filter(x=>!x[t.name]);let s={label:t.label,group:c||__(" "),collapsed:!1,rows:g(e)};t.name=="status"&&(s.icon=()=>{var x;return j(J,{class:(x=L(c))==null?void 0:x.iconColorClass})}),n.push(s)}),n||r}function d(r){let t=[];return r.forEach(n=>{var a;(a=n.data)==null||a.forEach(c=>{t.push(c)})}),g(t)}function g(r){return r.map(t=>{let n={};return u.value.data.rows.forEach(a=>{var c,e;if(n[a]=t[a],a=="customer")n[a]={label:t.customer,logo:(c=K(t.customer))==null?void 0:c.image};else if(a==="website")n[a]=ze(t.website);else if(a=="opportunity_amount")n[a]=Ae(t.opportunity_amount,t.currency);else if(a=="status")n[a]={label:t.status,color:(e=L(t.status))==null?void 0:e.iconColorClass};else if(a=="sla_status"){let s=t.sla_status,x=s,F=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";s=="First Response Due"&&(s=__(H(t.response_by)),x=X(t.response_by,Y),new Date(t.response_by)<new Date&&(F="red")),n[a]={label:x,value:s,color:F}}else if(a=="opportunity_owner")n[a]={label:t.opportunity_owner&&U(t.opportunity_owner).full_name,...t.opportunity_owner&&U(t.opportunity_owner)};else if(a=="_assign"){let s=JSON.parse(t._assign||"[]");!s.length&&t.opportunity_owner&&(s=[t.opportunity_owner]),n[a]=s.map(x=>({name:x,image:U(x).user_image,label:U(x).full_name}))}else if(["modified","creation"].includes(a))n[a]={label:X(t[a],Y),timeAgo:__(H(t[a]))};else if(["first_response_time","first_responded_on","response_by"].includes(a)){let s=a=="response_by"?"response_by":"first_responded_on";n[a]={label:t[s]?X(t[s],Y):"",timeAgo:t[a]?a=="first_response_time"?De(t[a]):__(H(t[a])):""}}}),n._email_count=t._email_count,n._note_count=t._note_count,n._task_count=t._task_count,n._comment_count=t._comment_count,n})}function p(r){let t=u.value.params.column_field;t&&(i[t]=r.column.name),M.value=!0}function G(r){var a;let t=((a=o(r,"mobile_no"))==null?void 0:a.label)||"";return[{icon:j(Ce,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>Q(t),condition:()=>t&&je.value},{icon:j(se,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>re(r)},{icon:j(ae,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>ce(r)}].filter(c=>c.condition?c.condition():!0)}const I=y(""),T=y(!1),z=y({title:"",content:""});function re(r){I.value=r,T.value=!0}const B=y(!1),ie=y({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function ce(r){I.value=r,B.value=!0}return(r,t)=>{const n=O("FeatherIcon"),a=O("Button"),c=O("Badge");return l(),m(be,null,[_($e,null,{"left-header":w(()=>[_(ke,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),routeName:"Opportunities"},null,8,["modelValue"])]),"right-header":w(()=>{var e;return[(e=E.value)!=null&&e.customListActions?(l(),k(we,{key:0,actions:E.value.customListActions},null,8,["actions"])):v("",!0),_(a,{variant:"solid",label:r.__("Create"),onClick:t[1]||(t[1]=s=>M.value=!0)},{prefix:w(()=>[_(n,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),_(ye,{ref_key:"viewControls",ref:h,modelValue:u.value,"onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),loadMore:$.value,"onUpdate:loadMore":t[3]||(t[3]=e=>$.value=e),resizeColumn:D.value,"onUpdate:resizeColumn":t[4]||(t[4]=e=>D.value=e),updatedPageCount:S.value,"onUpdate:updatedPageCount":t[5]||(t[5]=e=>S.value=e),doctype:"Opportunity",options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),V(A).params.viewType=="kanban"?(l(),k(Ue,{key:0,modelValue:u.value,"onUpdate:modelValue":t[7]||(t[7]=e=>u.value=e),options:{getRoute:e=>({name:"Opportunity",params:{opportunityId:e.name},query:{view:V(A).query.view,viewType:V(A).params.viewType}}),onNewClick:e=>p(e)},onUpdate:t[8]||(t[8]=e=>h.value.updateKanbanSettings(e)),onLoadMore:t[9]||(t[9]=e=>h.value.loadMoreKanban(e))},{title:w(({titleField:e,itemName:s})=>[f("div",Fe,[e==="status"?(l(),m("div",Ne,[_(J,{class:te(o(s,e).color)},null,8,["class"])])):e==="customer"&&o(s,e).label?(l(),m("div",et,[_(V(P),{class:"flex items-center",image:o(s,e).logo,label:o(s,e).label,size:"sm"},null,8,["image","label"])])):e==="opportunity_owner"&&o(s,e).full_name?(l(),m("div",tt,[_(V(P),{class:"flex items-center",image:o(s,e).user_image,label:o(s,e).full_name,size:"sm"},null,8,["image","label"])])):v("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(l(),m("div",st,[_(V(oe),{text:o(s,e).label},{default:w(()=>[f("div",null,C(o(s,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(l(),m("div",at,[o(s,e).value?(l(),k(c,{key:0,variant:"subtle",theme:o(s,e).color,size:"md",label:o(s,e).value},null,8,["theme","label"])):v("",!0)])):o(s,e).label?(l(),m("div",ot,C(o(s,e).label),1)):(l(),m("div",lt,C(r.__("No Title")),1))])]),fields:w(({fieldName:e,itemName:s})=>[o(s,e).label?(l(),m("div",nt,[e==="status"?(l(),m("div",ut,[_(J,{class:te(o(s,e).color)},null,8,["class"])])):e==="customer"?(l(),m("div",rt,[o(s,e).label?(l(),k(V(P),{key:0,class:"flex items-center",image:o(s,e).logo,label:o(s,e).label,size:"xs"},null,8,["image","label"])):v("",!0)])):e==="opportunity_owner"?(l(),m("div",it,[o(s,e).full_name?(l(),k(V(P),{key:0,class:"flex items-center",image:o(s,e).user_image,label:o(s,e).full_name,size:"xs"},null,8,["image","label"])):v("",!0)])):v("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(l(),m("div",ct,[_(V(oe),{text:o(s,e).label},{default:w(()=>[f("div",null,C(o(s,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(l(),m("div",_t,[o(s,e).value?(l(),k(c,{key:0,variant:"subtle",theme:o(s,e).color,size:"md",label:o(s,e).value},null,8,["theme","label"])):v("",!0)])):e==="_assign"?(l(),m("div",dt,[_(xe,{avatars:o(s,e).label,size:"xs"},null,8,["avatars"])])):(l(),m("div",pt,C(o(s,e).label),1))])):v("",!0)]),actions:w(({itemName:e})=>[f("div",mt,[f("div",ft,[_(he,{class:"h-4 w-4"}),o(e,"_email_count").label?(l(),m("span",vt,C(o(e,"_email_count").label),1)):v("",!0),bt,_(se,{class:"h-4 w-4"}),o(e,"_note_count").label?(l(),m("span",gt,C(o(e,"_note_count").label),1)):v("",!0),yt,_(ae,{class:"h-4 w-4"}),o(e,"_task_count").label?(l(),m("span",kt,C(o(e,"_task_count").label),1)):v("",!0),xt,_(Ee,{class:"h-4 w-4"}),o(e,"_comment_count").label?(l(),m("span",wt,C(o(e,"_comment_count").label),1)):v("",!0)]),_(V(Pe),{class:"flex items-center gap-2",options:G(e),variant:"ghost",onClick:t[6]||(t[6]=ge(()=>{},["stop","prevent"]))},{default:w(()=>[_(a,{icon:"plus",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):u.value.data&&q.value.length?(l(),k(Oe,{key:1,ref_key:"opportunitiesListView",ref:E,modelValue:u.value.data.page_length_count,"onUpdate:modelValue":t[10]||(t[10]=e=>u.value.data.page_length_count=e),list:u.value,"onUpdate:list":t[11]||(t[11]=e=>u.value=e),rows:q.value,columns:u.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:u.value.data.row_count,totalCount:u.value.data.total_count},onLoadMore:t[12]||(t[12]=()=>$.value++),onColumnWidthUpdated:t[13]||(t[13]=()=>D.value++),onUpdatePageCount:t[14]||(t[14]=e=>S.value=e),onApplyFilter:t[15]||(t[15]=e=>h.value.applyFilter(e)),onApplyLikeFilter:t[16]||(t[16]=e=>h.value.applyLikeFilter(e)),onLikeDoc:t[17]||(t[17]=e=>h.value.likeDoc(e))},null,8,["modelValue","list","rows","columns","options"])):u.value.data?(l(),m("div",ht,[f("div",Ct,[_(Me,{class:"h-10 w-10"}),f("span",null,C(r.__("No {0} Found",[r.__("Opportunities")])),1),_(a,{label:r.__("Create"),onClick:t[18]||(t[18]=e=>M.value=!0)},{prefix:w(()=>[_(n,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):v("",!0),M.value?(l(),k(Ze,{key:3,modelValue:M.value,"onUpdate:modelValue":t[19]||(t[19]=e=>M.value=e),quickEntry:b.value,"onUpdate:quickEntry":t[20]||(t[20]=e=>b.value=e),defaults:i},null,8,["modelValue","quickEntry","defaults"])):v("",!0),T.value?(l(),k(Ve,{key:4,modelValue:T.value,"onUpdate:modelValue":t[21]||(t[21]=e=>T.value=e),note:z.value,doctype:"Opportunity",doc:I.value},null,8,["modelValue","note","doc"])):v("",!0),B.value?(l(),k(Re,{key:5,modelValue:B.value,"onUpdate:modelValue":t[22]||(t[22]=e=>B.value=e),task:ie.value,doctype:"Opportunity",doc:I.value},null,8,["modelValue","task","doc"])):v("",!0),b.value?(l(),k(Le,{key:6,modelValue:b.value,"onUpdate:modelValue":t[23]||(t[23]=e=>b.value=e),doctype:"Opportunity"},null,8,["modelValue"])):v("",!0)],64)}}};export{ls as default};
//# sourceMappingURL=Opportunities-bc0e2d66.js.map
