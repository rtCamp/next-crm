import{_ as ne}from"./Section-3c95fd43.js";import{g as me,S as ue,_ as ce}from"./view-43ec0067.js";import{a as de}from"./FadedScrollableDiv-10ee6cf2.js";import{_ as _e}from"./LayoutHeader-72a3cdee.js";import{_ as pe}from"./AddressModal-e11ac707.js";import{_ as fe}from"./OpportunitiesListView-bab2c24d.js";import{_ as ge}from"./ContactsListView-76da7066.js";import{D as ye}from"./DetailsIcon-14f9b41c.js";import{C as be}from"./CameraIcon-91addc5f.js";import{O as he}from"./OpportunitiesIcon-89f01f41.js";import{C as we}from"./ContactsIcon-a70cc581.js";import{u as ve,g as Ce,h as xe,d as q,t as N,b as ke,e as R,c as U}from"./index-b1bb6af7.js";import{s as Ie}from"./statuses-6fc48ca5.js";import{h as Ve,v as De,J as Fe,j as y,K as Le,l as x,x as Be,B as A,L as M,r as k,b as l,c as _,u as a,g as p,w as m,p as u,d as i,F as P,I as D,e as n,C as Oe,G as F,t as I,n as L,H as z,f as Se}from"./index-8ca2d158.js";import{_ as $e}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-28c0bac8.js";import{_ as je}from"./Dropdown.vue_vue_type_script_setup_true_lang-dba778cd.js";import{F as Te}from"./FileUploader-e5eb09df.js";import"./views-5d4a0486.js";import"./ArrowUpRightIcon-c299f2a1.js";import"./QuickEntryModal-ebc5f118.js";import"./Fields-02fbbc9b.js";import"./IndicatorIcon-367a8d49.js";import"./DatePicker-0e72d67e.js";import"./DragVerticalIcon-523c4542.js";import"./Switch.vue_vue_type_script_setup_true_lang-cbc97d13.js";import"./ListBulkActions-ccdc1c2a.js";import"./AssignmentModal-759f92c3.js";import"./PhoneIcon-42af6989.js";import"./ListRows-7339a2c3.js";import"./ListFooter-ed664a38.js";const qe={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Ne={key:1,class:"flex flex-col h-full overflow-hidden"},Re={class:"flex flex-col items-start justify-start gap-4 p-4"},Ue={class:"flex gap-4 items-center"},Ae={class:"group relative h-14.5 w-14.5"},Me={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Pe={class:"flex flex-col gap-2 truncate"},ze={class:"truncate text-lg font-medium"},Ee={class:"flex items-center gap-1.5"},Ge={key:0},Je={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},We={class:"flex flex-col overflow-y-auto"},He={key:3,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},Ke={class:"flex flex-col items-center justify-center space-y-3"},Vt={__name:"MobileCustomer",props:{customerId:{type:String,required:!0}},setup(E){const s=E,{getUser:B}=ve(),{$dialog:G}=Ce(),{getDealStatus:J}=Ie(),f=Ve(),W=De(),r=Fe({doctype:"Customer",name:s.customerId,cache:["customer",s.customerId],fields:["*"],auto:!0});async function H(e,t){await r.setValue.submit({[e]:t}),R({title:__("Customer updated"),icon:"check",iconClasses:"text-green-600"})}const K=y(()=>{let e=[{label:__("Customers"),route:{name:"Customers"}}];if(f.query.view||f.query.viewType){let t=me(f.query.view,f.query.viewType,"Customer");t&&e.push({label:__(t.label),icon:t.icon,route:{name:"Customers",params:{viewType:f.query.viewType},query:{view:f.query.view}}})}return e.push({label:s.customerId,route:{name:"Customer",params:{customerId:s.customerId}}}),e});Le(()=>({title:s.customerId}));function Q(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return __("Only PNG and JPG images are allowed")}async function O(e){await D("frappe.client.set_value",{doctype:"Customer",name:s.customerId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),r.reload()}async function X(){G({title:__("Delete customer"),message:__("Are you sure you want to delete this customer?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await D("frappe.client.delete",{doctype:"Customer",name:s.customerId}),e(),W.push({name:"Customers"})}}]})}function Y(){r.doc.website?window.open(r.doc.website,"_blank"):R({title:__("Website not found"),icon:"x",iconClasses:"text-red-600"})}const w=x(!1),Z=x({}),v=x({}),C=Be({url:"next_crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",s.customerId],params:{doctype:"Customer",name:s.customerId},auto:!0,transform:e=>ee(e)});function ee(e){return e.map(t=>({...t,fields:y(()=>t.fields.map(c=>c.name==="address"?{...c,create:(g,V)=>{Z.value.address=g,v.value={},w.value=!0,V()},edit:async g=>{v.value=await D("frappe.client.get",{doctype:"Address",name:g}),w.value=!0}}:c))}))}const b=x(0),te=[{name:"Details",label:__("Details"),icon:ye},{name:"Opportunities",label:__("Opportunities"),icon:A(he,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=S.data)==null?void 0:e.length})},{name:"Contacts",label:__("Contacts"),icon:A(we,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=$.data)==null?void 0:e.length})}],S=M({type:"list",doctype:"Opportunity",cache:["opportunities",s.customerId],fields:["name","customer","currency","opportunity_amount","status","contact_email","contact_mobile","opportunity_owner","modified"],filters:{customer:s.customerId},orderBy:"modified desc",pageLength:20,auto:!0}),$=M({type:"list",doctype:"Contact",cache:["contacts",s.customerId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:s.customerId},orderBy:"modified desc",pageLength:20,auto:!0}),h=y(()=>{let e=[];return e=b.value?$:S,e.data?e.data.map(t=>b.value?ae(t):oe(t)):[]}),j=y(()=>b.value===0?se:le);function oe(e){var t,c;return{name:e.name,customer:{label:e.customer,logo:(t=s.customer)==null?void 0:t.image},opportunity_amount:xe(e.opportunity_amount,e.currency),status:{label:e.status,color:(c=J(e.status))==null?void 0:c.iconColorClass},email:e.email,mobile_no:e.mobile_no,opportunity_owner:{label:e.opportunity_owner&&B(e.opportunity_owner).full_name,...e.opportunity_owner&&B(e.opportunity_owner)},modified:{label:q(e.modified,U),timeAgo:__(N(e.modified))}}}function ae(e){var t;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(t=s.customer)==null?void 0:t.image},modified:{label:q(e.modified,U),timeAgo:__(N(e.modified))}}}const se=[{label:__("Customer"),key:"customer",width:"11rem"},{label:__("Amount"),key:"opportunity_amount",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"contact_email",width:"12rem"},{label:__("Mobile no"),key:"contact_mobile",width:"11rem"},{label:__("Opportunity owner"),key:"opportunity_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],le=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Customer"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,t)=>{const c=k("FeatherIcon"),g=k("Button"),V=k("ErrorMessage"),re=k("Badge");return l(),_(P,null,[a(r).doc?(l(),p(_e,{key:0},{default:m(()=>[n("header",qe,[i(a($e),{items:K.value},{prefix:m(({item:o})=>[o.icon?(l(),p(de,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):u("",!0)]),_:1},8,["items"])])]),_:1})):u("",!0),a(r).doc?(l(),_("div",Ne,[i(a(Te),{onSuccess:O,validateFile:Q},{default:m(({openFileSelector:o,error:d})=>[n("div",Re,[n("div",Ue,[n("div",Ae,[i(a(ke),{size:"3xl",class:"h-14.5 w-14.5",label:a(r).doc.customer_name,image:a(r).doc.image},null,8,["label","image"]),(l(),p(F(a(r).doc.image?a(je):"div"),Oe(a(r).doc.image?{options:[{icon:"upload",label:a(r).doc.image?e.__("Change image"):e.__("Upload image"),onClick:o},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>O("")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:m(()=>[n("div",Me,[i(be,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),n("div",Pe,[n("div",ze,I(a(r).doc.name),1),n("div",Ee,[i(g,{onClick:Y},{default:m(()=>[i(c,{name:"link",class:"h-4 w-4"})]),_:1}),i(g,{label:e.__("Delete"),theme:"red",size:"sm",onClick:X},{prefix:m(()=>[i(c,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])]),i(V,{message:e.__(d)},null,8,["message"])])])])]),_:1}),i(a(ce),{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=o=>b.value=o),tabs:te,tablistClass:"!px-4",class:"overflow-auto"},{tab:m(({tab:o,selected:d})=>[o.name!=="Details"?(l(),_("button",{key:0,class:L(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":d}])},[o.icon?(l(),p(F(o.icon),{key:0,class:"h-5"})):u("",!0),z(" "+I(e.__(o.label))+" ",1),i(re,{class:L(["group-hover:bg-gray-900",[d?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:m(()=>[z(I(o.count),1)]),_:2},1032,["class"])],2)):u("",!0)]),default:m(({tab:o})=>[o.name=="Details"?(l(),_("div",Ge,[a(C).data?(l(),_("div",Je,[n("div",We,[(l(!0),_(P,null,Se(a(C).data,(d,T)=>(l(),_("div",{key:d.label,class:L(["flex flex-col px-2 py-3 sm:p-3",{"border-b":T!==a(C).data.length-1}])},[i(ne,{"is-opened":d.opened,label:d.label},{default:m(()=>[i(ue,{fields:d.fields,isLastSection:T==a(C).data.length-1,modelValue:a(r).doc,"onUpdate:modelValue":t[0]||(t[0]=ie=>a(r).doc=ie),onUpdate:H},null,8,["fields","isLastSection","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):u("",!0)])):u("",!0),o.label==="Opportunities"&&h.value.length?(l(),p(fe,{key:1,class:"mt-4",rows:h.value,columns:j.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):u("",!0),o.label==="Contacts"&&h.value.length?(l(),p(ge,{key:2,class:"mt-4",rows:h.value,columns:j.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):u("",!0),!h.value.length&&o.name!=="Details"?(l(),_("div",He,[n("div",Ke,[(l(),p(F(o.icon),{class:"!h-10 !w-10"})),n("div",null,I(e.__("No {0} Found",[e.__(o.label)])),1)])])):u("",!0)]),_:1},8,["modelValue"])])):u("",!0),i(pe,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=o=>w.value=o),address:v.value,"onUpdate:address":t[3]||(t[3]=o=>v.value=o)},null,8,["modelValue","address"])],64)}}};export{Vt as default};
//# sourceMappingURL=MobileCustomer-f789ad17.js.map
