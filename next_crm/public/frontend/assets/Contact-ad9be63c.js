import{_ as me,a as ue}from"./SidePanelModal-7a4a2300.js";import{a as _e}from"./FadedScrollableDiv-10ee6cf2.js";import{_ as pe}from"./Section-3c95fd43.js";import{g as fe,S as ge,_ as ve}from"./view-43ec0067.js";import{_ as be}from"./LayoutHeader-72a3cdee.js";import{P as he}from"./PhoneIcon-42af6989.js";import{E as ye}from"./views-5d4a0486.js";import{C as we}from"./CameraIcon-91addc5f.js";import{O as Ce}from"./OpportunitiesIcon-89f01f41.js";import{_ as xe}from"./OpportunitiesListView-bab2c24d.js";import{_ as ke}from"./AddressModal-e11ac707.js";import{g as Ie,u as Ve,e as V,h as Se,d as $e,t as Fe,b as J,c as Pe}from"./index-b1bb6af7.js";import{c as Ne}from"./customers-8d8733e3.js";import{s as Oe}from"./statuses-6fc48ca5.js";import{c as je}from"./settings-9f3d7d3a.js";import{h as Be,v as Ee,l as S,x as U,j as $,K as Ue,B as qe,r as B,b as r,c as y,u as o,g as p,w as m,p as u,e as c,d,F as K,I as b,G as q,C as De,t as C,f as Me,n as D,H as Q}from"./index-8ca2d158.js";import{_ as Re}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-28c0bac8.js";import{_ as Te}from"./Dropdown.vue_vue_type_script_setup_true_lang-dba778cd.js";import{F as ze}from"./FileUploader-e5eb09df.js";import"./DragVerticalIcon-523c4542.js";import"./Switch.vue_vue_type_script_setup_true_lang-cbc97d13.js";import"./ArrowUpRightIcon-c299f2a1.js";import"./ListBulkActions-ccdc1c2a.js";import"./DatePicker-0e72d67e.js";import"./AssignmentModal-759f92c3.js";import"./IndicatorIcon-367a8d49.js";import"./ListRows-7339a2c3.js";import"./ListFooter-ed664a38.js";import"./QuickEntryModal-ebc5f118.js";import"./Fields-02fbbc9b.js";const Ae={ref:"parentRef",class:"flex h-full"},Le={class:"border-b"},Ge={class:"flex flex-col items-start justify-start gap-4 p-5"},He={class:"flex gap-4 items-center"},Je={class:"group relative h-15.5 w-15.5"},Ke={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Qe={class:"flex flex-col gap-2 truncate"},We={class:"truncate text-2xl font-medium"},Xe={key:0},Ye={key:0,class:"flex items-center gap-1.5 text-base text-gray-800"},Ze={class:""},ea={class:"flex gap-1.5"},aa={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},ta={class:"flex flex-col overflow-y-auto"},oa={key:1,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},la={class:"flex flex-col items-center justify-center space-y-3"},Ea={__name:"Contact",props:{contactId:{type:String,required:!0}},setup(W){const{$dialog:X,makeCall:Y}=Ie(),{getUser:M,isManager:Z}=Ve(),{getCustomer:R}=Ne(),{getDealStatus:ee}=Oe(),f=W,w=Be(),ae=Ee(),F=S(!1),P=S(!1),_=S({}),N=S({}),a=U({url:"next_crm.api.contact.get_contact",cache:["contact",f.contactId],params:{name:f.contactId},auto:!0,transform:e=>({...e,actual_mobile_no:e.mobile_no,mobile_no:e.mobile_no})}),te=$(()=>{var t;let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(w.query.view||w.query.viewType){let i=fe(w.query.view,w.query.viewType,"Contact");i&&e.push({label:__(i.label),icon:i.icon,route:{name:"Contacts",params:{viewType:w.query.viewType},query:{view:w.query.view}}})}return e.push({label:(t=a.data)==null?void 0:t.full_name,route:{name:"Contact",params:{contactId:f.contactId}}}),e});Ue(()=>{var e,t;return{title:((e=a.data)==null?void 0:e.full_name)||((t=a.data)==null?void 0:t.name)}});function oe(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return __("Only PNG and JPG images are allowed")}async function T(e){await b("frappe.client.set_value",{doctype:"Contact",name:f.contactId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),a.reload()}async function le(){X({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await b("frappe.client.delete",{doctype:"Contact",name:f.contactId}),e(),ae.push({name:"Contacts"})}}]})}const z=S(0),ne=[{label:"Opportunities",icon:qe(Ce,{class:"h-4 w-4"}),count:$(()=>{var e;return(e=O.data)==null?void 0:e.length})}],O=U({url:"next_crm.api.contact.get_linked_opportunities",cache:["opportunities",f.contactId],params:{contact:f.contactId},auto:!0}),E=$(()=>!O.data||O.data==[]?[]:O.data.map(e=>ce(e))),x=U({url:"next_crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",f.contactId],params:{doctype:"Contact",name:f.contactId},auto:!0,transform:e=>se(e)});function se(e){return e.map(t=>({...t,fields:$(()=>t.fields.map(i=>{var g,k,j,l;return i.name==="email_id"?{...i,type:"dropdown",options:((k=(g=a.data)==null?void 0:g.email_ids)==null?void 0:k.map(n=>({name:n.name,value:n.email_id,selected:n.email_id===a.data.email_id,placeholder:"john@doe.com",onClick:()=>{_.value.email_id=n.email_id,A("email",n.email_id)},onSave:(s,v)=>{v?(L("email",s.value),a.data.email_ids.length===1&&(_.value.email_id=s.value)):G("Contact Email",s.name,"email_id",s.value)},onDelete:async(s,v)=>{var I;a.data.email_ids=a.data.email_ids.filter(h=>h.name!==s.name),!v&&await H("Contact Email",s.name),_.value.email_id===s.value&&(a.data.email_ids.length===0?_.value.email_id="":_.value.email_id=(I=a.data.email_ids.find(h=>h.is_primary))==null?void 0:I.email_id)}})))||[],create:()=>{var n,s;(s=(n=a.data)==null?void 0:n.email_ids)==null||s.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:i.name==="mobile_no"?{...i,type:"dropdown",options:((l=(j=a.data)==null?void 0:j.phone_nos)==null?void 0:l.map(n=>({name:n.name,value:n.phone,selected:n.phone===a.data.actual_mobile_no,onClick:()=>{_.value.actual_mobile_no=n.phone,_.value.mobile_no=n.phone,A("mobile_no",n.phone)},onSave:(s,v)=>{v?(L("phone",s.value),a.data.phone_nos.length===1&&(_.value.actual_mobile_no=s.value)):G("Contact Phone",s.name,"phone",s.value)},onDelete:async(s,v)=>{var I;a.data.phone_nos=a.data.phone_nos.filter(h=>h.name!==s.name),!v&&await H("Contact Phone",s.name),_.value.actual_mobile_no===s.value&&(a.data.phone_nos.length===0?_.value.actual_mobile_no="":_.value.actual_mobile_no=(I=a.data.phone_nos.find(h=>h.is_primary_mobile_no))==null?void 0:I.phone)}})))||[],create:()=>{var n,s;(s=(n=a.data)==null?void 0:n.phone_nos)==null||s.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:i.name==="address"?{...i,create:(n,s)=>{_.value.address=n,N.value={},F.value=!0,s()},edit:async n=>{N.value=await b("frappe.client.get",{doctype:"Address",name:n}),F.value=!0}}:i}))}))}async function A(e,t){await b("next_crm.api.contact.set_as_primary",{contact:a.data.name,field:e,value:t})&&(a.reload(),V({title:"Contact updated",icon:"check",iconClasses:"text-green-600"}))}async function L(e,t){if(!t)return;await b("next_crm.api.contact.create_new",{contact:a.data.name,field:e,value:t})&&(a.reload(),V({title:"Contact updated",icon:"check",iconClasses:"text-green-600"}))}async function G(e,t,i,g){await b("frappe.client.set_value",{doctype:e,name:t,fieldname:i,value:g})&&(a.reload(),V({title:"Contact updated",icon:"check",iconClasses:"text-green-600"}))}async function H(e,t){await b("frappe.client.delete",{doctype:e,name:t}),await a.reload(),V({title:"Contact updated",icon:"check",iconClasses:"text-green-600"})}async function ie(e,t){await b("frappe.client.set_value",{doctype:"Contact",name:f.contactId,fieldname:e,value:t}),V({title:"Contact updated",icon:"check",iconClasses:"text-green-600"}),a.reload()}const re=$(()=>de);function ce(e){var t,i;return{name:e.name,customer:{label:e.customer,logo:(t=R(e.customer))==null?void 0:t.image},opportunity_amount:Se(e.opportunity_amount,e.currency),status:{label:e.status,color:(i=ee(e.status))==null?void 0:i.iconColorClass},email:e.email,mobile_no:e.mobile_no,opportunity_owner:{label:e.opportunity_owner&&M(e.opportunity_owner).full_name,...e.opportunity_owner&&M(e.opportunity_owner)},modified:{label:$e(e.modified,Pe),timeAgo:__(Fe(e.modified))}}}const de=[{label:__("Customer"),key:"customer",width:"11rem"},{label:__("Amount"),key:"opportunity_amount",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"contact_email",width:"12rem"},{label:__("Mobile no"),key:"contact_mobile",width:"11rem"},{label:__("Opportunity owner"),key:"opportunity_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,t)=>{const i=B("ErrorMessage"),g=B("Button"),k=B("FeatherIcon"),j=B("Badge");return r(),y(K,null,[o(a).data?(r(),p(be,{key:0},{"left-header":m(()=>[d(o(Re),{items:te.value},{prefix:m(({item:l})=>[l.icon?(r(),p(_e,{key:0,icon:l.icon,class:"mr-2 h-4"},null,8,["icon"])):u("",!0)]),_:1},8,["items"])]),_:1})):u("",!0),c("div",Ae,[o(a).data?(r(),p(me,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:m(()=>[c("div",Le,[d(o(ze),{onSuccess:T,validateFile:oe},{default:m(({openFileSelector:l,error:n})=>{var s;return[c("div",Ge,[c("div",He,[c("div",Je,[d(o(J),{size:"3xl",class:"h-15.5 w-15.5",label:o(a).data.full_name,image:o(a).data.image},null,8,["label","image"]),(r(),p(q(o(a).data.image?o(Te):"div"),De(o(a).data.image?{options:[{icon:"upload",label:o(a).data.image?e.__("Change image"):e.__("Upload image"),onClick:l},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>T("")}]}:{onClick:l},{class:"!absolute bottom-0 left-0 right-0"}),{default:m(()=>[c("div",Ke,[d(we,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),c("div",Qe,[c("div",We,[o(a).data.salutation?(r(),y("span",Xe,C(o(a).data.salutation+". "),1)):u("",!0),c("span",null,C(o(a).data.full_name),1)]),o(a).data.company_name?(r(),y("div",Ye,[d(o(J),{size:"xs",label:o(a).data.company_name,image:(s=o(R)(o(a).data.company_name))==null?void 0:s.image},null,8,["label","image"]),c("span",Ze,C(o(a).data.company_name),1)])):u("",!0),d(i,{message:e.__(n)},null,8,["message"])])]),c("div",ea,[o(a).data.actual_mobile_no?(r(),p(g,{key:0,label:e.__("Make Call"),size:"sm",onClick:t[0]||(t[0]=v=>o(je)&&o(Y)(o(a).data.actual_mobile_no))},{prefix:m(()=>[d(he,{class:"h-4 w-4"})]),_:1},8,["label"])):u("",!0),d(g,{label:e.__("Delete"),theme:"red",size:"sm",onClick:le},{prefix:m(()=>[d(k,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])])])]}),_:1})]),o(x).data?(r(),y("div",aa,[c("div",ta,[(r(!0),y(K,null,Me(o(x).data,(l,n)=>(r(),y("div",{key:l.label,class:D(["flex flex-col p-3",{"border-b":n!==o(x).data.length-1}])},[d(pe,{"is-opened":l.opened,label:l.label},{actions:m(()=>[n==0&&o(Z)()?(r(),p(g,{key:0,variant:"ghost",class:"w-7",onClick:t[1]||(t[1]=s=>P.value=!0)},{default:m(()=>[d(ye,{class:"h-4 w-4"})]),_:1})):u("",!0)]),default:m(()=>[l.fields?(r(),p(ge,{key:0,fields:l.fields,isLastSection:n==o(x).data.length-1,modelValue:o(a).data,"onUpdate:modelValue":t[2]||(t[2]=s=>o(a).data=s),onUpdate:ie},null,8,["fields","isLastSection","modelValue"])):u("",!0)]),_:2},1032,["is-opened","label"])],2))),128))])])):u("",!0)]),_:1},8,["parent"])):u("",!0),d(o(ve),{class:"overflow-hidden",modelValue:z.value,"onUpdate:modelValue":t[3]||(t[3]=l=>z.value=l),tabs:ne},{tab:m(({tab:l,selected:n})=>[c("button",{class:D(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":n}])},[l.icon?(r(),p(q(l.icon),{key:0,class:"h-5"})):u("",!0),Q(" "+C(e.__(l.label))+" ",1),d(j,{class:D(["group-hover:bg-gray-900",[n?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:m(()=>[Q(C(l.count),1)]),_:2},1032,["class"])],2)]),default:m(({tab:l})=>[l.label==="Opportunities"&&E.value.length?(r(),p(xe,{key:0,class:"mt-4",rows:E.value,columns:re.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):u("",!0),E.value.length?u("",!0):(r(),y("div",oa,[c("div",la,[(r(),p(q(l.icon),{class:"!h-10 !w-10"})),c("div",null,C(e.__("No {0} Found",[e.__(l.label)])),1)])]))]),_:1},8,["modelValue"])],512),P.value?(r(),p(ue,{key:1,modelValue:P.value,"onUpdate:modelValue":t[4]||(t[4]=l=>P.value=l),doctype:"Contact",onReload:t[5]||(t[5]=()=>o(x).reload())},null,8,["modelValue"])):u("",!0),d(ke,{modelValue:F.value,"onUpdate:modelValue":t[6]||(t[6]=l=>F.value=l),address:N.value,"onUpdate:address":t[7]||(t[7]=l=>N.value=l)},null,8,["modelValue","address"])],64)}}};export{Ea as default};
//# sourceMappingURL=Contact-ad9be63c.js.map
