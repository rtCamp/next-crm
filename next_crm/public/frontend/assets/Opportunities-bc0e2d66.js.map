{"version":3,"file":"Opportunities-bc0e2d66.js","sources":["../../../../frontend/src/components/Modals/OpportunityModal.vue","../../../../frontend/src/pages/Opportunities.vue"],"sourcesContent":["<template>\n  <Dialog v-model=\"show\" :options=\"{ size: '3xl' }\">\n    <template #body>\n      <div class=\"bg-white px-4 pb-6 pt-5 sm:px-6\">\n        <div class=\"mb-5 flex items-center justify-between\">\n          <div>\n            <h3 class=\"text-2xl font-semibold leading-6 text-gray-900\">\n              {{ __('Create Opportunity') }}\n            </h3>\n          </div>\n          <div class=\"flex items-center gap-1\">\n            <Button\n              v-if=\"isManager()\"\n              variant=\"ghost\"\n              class=\"w-7\"\n              @click=\"openQuickEntryModal\"\n            >\n              <EditIcon class=\"h-4 w-4\" />\n            </Button>\n            <Button variant=\"ghost\" class=\"w-7\" @click=\"show = false\">\n              <FeatherIcon name=\"x\" class=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n        <div>\n          <div class=\"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3\">\n            <div class=\"flex items-center gap-3 text-sm text-gray-600\">\n              <div>{{ __('Choose Existing Customer') }}</div>\n              <Switch v-model=\"chooseExistingCustomer\" />\n            </div>\n          </div>\n          <Fields\n            v-if=\"filteredSections\"\n            class=\"border-t pt-4\"\n            :sections=\"filteredSections\"\n            :data=\"opportunity\"\n          />\n          <ErrorMessage class=\"mt-4\" v-if=\"error\" :message=\"__(error)\" />\n        </div>\n      </div>\n      <div class=\"px-4 pb-7 pt-4 sm:px-6\">\n        <div class=\"flex flex-row-reverse gap-2\">\n          <Button\n            variant=\"solid\"\n            :label=\"__('Create')\"\n            :loading=\"isOpportunityCreating\"\n            @click=\"createOpportunity\"\n          />\n        </div>\n      </div>\n    </template>\n  </Dialog>\n</template>\n\n<script setup>\nimport EditIcon from '@/components/Icons/EditIcon.vue'\nimport Fields from '@/components/Fields.vue'\nimport { usersStore } from '@/stores/users'\nimport { statusesStore } from '@/stores/statuses'\nimport { capture } from '@/telemetry'\nimport { Switch, createResource } from 'frappe-ui'\nimport { computed, ref, reactive, onMounted, nextTick } from 'vue'\nimport { useRouter } from 'vue-router'\n\nconst props = defineProps({\n  defaults: Object,\n})\n\nconst { getUser, isManager } = usersStore()\nconst { getDealStatus, statusOptions } = statusesStore()\n\nconst show = defineModel()\nconst router = useRouter()\nconst error = ref(null)\n\nconst opportunity = reactive({\n  customer: '',\n  customer_name: '',\n  website: '',\n  no_of_employees: '',\n  territory: '',\n  industry: '',\n  contact: '',\n  salutation: '',\n  first_name: '',\n  last_name: '',\n  email: '',\n  mobile_no: '',\n  gender: '',\n  status: '',\n  opportunity_owner: '',\n  lead: '',\n  opportunity_amount: '',\n})\n\nconst isOpportunityCreating = ref(false)\nconst chooseExistingCustomer = ref(false)\n\nconst sections = createResource({\n  url: 'next_crm.ncrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout',\n  cache: ['quickEntryFields', 'Opportunity'],\n  params: { doctype: 'Opportunity', type: 'Quick Entry' },\n  auto: true,\n  transform: (data) => {\n    return data.forEach((section) => {\n      section.fields.forEach((field) => {\n        if (field.name == 'status') {\n          field.type = 'Select'\n          field.options = opportunityStatuses.value\n          field.prefix = getDealStatus(opportunity.status).iconColorClass\n        } else if (field.name == 'opportunity_owner') {\n          field.type = 'User'\n        }\n      })\n    })\n  },\n})\n\nconst filteredSections = computed(() => {\n  let allSections = sections.data || []\n  if (!allSections.length) return []\n\n  let _filteredSections = []\n\n  if (chooseExistingCustomer.value) {\n    _filteredSections.push(\n      allSections.find((s) => s.label === 'Select Customer'),\n    )\n  } else {\n    _filteredSections.push(\n      allSections.find((s) => s.label === 'Customer Details'),\n    )\n  }\n\n  _filteredSections.push(\n    allSections.find((s) => s.label === 'Select Contact'),\n  )\n\n\n  allSections.forEach((s) => {\n    if (\n      ![\n        'Select Customer',\n        'Customer Details',\n        'Select Contact',\n      ].includes(s.label)\n    ) {\n      _filteredSections.push(s)\n    }\n  })\n\n  return _filteredSections\n})\n\nconst opportunityStatuses = computed(() => {\n  let statuses = statusOptions('deal')\n  if (!opportunity.status) {\n    opportunity.status = statuses[0].value\n  }\n  return statuses\n})\n\nfunction createOpportunity() {\n  if (opportunity.website && !opportunity.website.startsWith('http')) {\n    opportunity.website = 'https://' + opportunity.website\n  }\n  createResource({\n    url: 'next_crm.overrides.opportunity.create_opportunity',\n    params: { args: opportunity },\n    auto: true,\n    validate() {\n      error.value = null\n      if (opportunity.opportunity_amount) {\n        opportunity.opportunity_amount = opportunity.opportunity_amount.replace(/,/g, '')\n        if (isNaN(opportunity.opportunity_amount)) {\n          error.value = __('Annual Revenue should be a number')\n          return error.value\n        }\n      }\n      if (opportunity.mobile_no && isNaN(opportunity.mobile_no.replace(/[-+() ]/g, ''))) {\n        error.value = __('Mobile No should be a number')\n        return error.value\n      }\n      if (opportunity.email && !opportunity.email.includes('@')) {\n        error.value = __('Invalid Email')\n        return error.value\n      }\n      if (!opportunity.status) {\n        error.value = __('Status is required')\n        return error.value\n      }\n      isOpportunityCreating.value = true\n    },\n    onSuccess(name) {\n      capture('opportunity_created')\n      isOpportunityCreating.value = false\n      show.value = false\n      router.push({ name: 'Opportunity', params: { opportunityId: name } })\n    },\n    onError(err) {\n      isOpportunityCreating.value = false\n      if (!err.messages) {\n        error.value = err.message\n        return\n      }\n      error.value = err.messages.join('\\n')\n    },\n  })\n}\n\nconst showQuickEntryModal = defineModel('quickEntry')\n\nfunction openQuickEntryModal() {\n  showQuickEntryModal.value = true\n  nextTick(() => {\n    show.value = false\n  })\n}\n\nonMounted(() => {\n  Object.assign(opportunity, props.defaults)\n  if (!opportunity.opportunity_owner) {\n    opportunity.opportunity_owner = getUser().name\n  }\n  if (!opportunity.status && opportunityStatuses.value[0].value) {\n    opportunity.status = opportunityStatuses.value[0].value\n  }\n})\n</script>\n","<template>\n  <LayoutHeader>\n    <template #left-header>\n      <ViewBreadcrumbs v-model=\"viewControls\" routeName=\"Opportunities\" />\n    </template>\n    <template #right-header>\n      <CustomActions\n        v-if=\"opportunitiesListView?.customListActions\"\n        :actions=\"opportunitiesListView.customListActions\"\n      />\n      <Button\n        variant=\"solid\"\n        :label=\"__('Create')\"\n        @click=\"showOpportunityModal = true\"\n      >\n        <template #prefix><FeatherIcon name=\"plus\" class=\"h-4\" /></template>\n      </Button>\n    </template>\n  </LayoutHeader>\n  <ViewControls\n    ref=\"viewControls\"\n    v-model=\"opportunities\"\n    v-model:loadMore=\"loadMore\"\n    v-model:resizeColumn=\"triggerResize\"\n    v-model:updatedPageCount=\"updatedPageCount\"\n    doctype=\"Opportunity\"\n    :options=\"{\n      allowedViews: ['list', 'group_by', 'kanban'],\n    }\"\n  />\n  <KanbanView\n    v-if=\"route.params.viewType == 'kanban'\"\n    v-model=\"opportunities\"\n    :options=\"{\n      getRoute: (row) => ({\n        name: 'Opportunity',\n        params: { opportunityId: row.name },\n        query: { view: route.query.view, viewType: route.params.viewType },\n      }),\n      onNewClick: (column) => onNewClick(column),\n    }\"\n    @update=\"(data) => viewControls.updateKanbanSettings(data)\"\n    @loadMore=\"(columnName) => viewControls.loadMoreKanban(columnName)\"\n  >\n    <template #title=\"{ titleField, itemName }\">\n      <div class=\"flex gap-2 items-center\">\n        <div v-if=\"titleField === 'status'\">\n          <IndicatorIcon :class=\"getRow(itemName, titleField).color\" />\n        </div>\n        <div\n          v-else-if=\"\n            titleField === 'customer' && getRow(itemName, titleField).label\n          \"\n        >\n          <Avatar\n            class=\"flex items-center\"\n            :image=\"getRow(itemName, titleField).logo\"\n            :label=\"getRow(itemName, titleField).label\"\n            size=\"sm\"\n          />\n        </div>\n        <div\n          v-else-if=\"\n            titleField === 'opportunity_owner' &&\n            getRow(itemName, titleField).full_name\n          \"\n        >\n          <Avatar\n            class=\"flex items-center\"\n            :image=\"getRow(itemName, titleField).user_image\"\n            :label=\"getRow(itemName, titleField).full_name\"\n            size=\"sm\"\n          />\n        </div>\n        <div\n          v-if=\"\n            [\n              'modified',\n              'creation',\n              'first_response_time',\n              'first_responded_on',\n              'response_by',\n            ].includes(titleField)\n          \"\n          class=\"truncate text-base\"\n        >\n          <Tooltip :text=\"getRow(itemName, titleField).label\">\n            <div>{{ getRow(itemName, titleField).timeAgo }}</div>\n          </Tooltip>\n        </div>\n        <div v-else-if=\"titleField === 'sla_status'\" class=\"truncate text-base\">\n          <Badge\n            v-if=\"getRow(itemName, titleField).value\"\n            :variant=\"'subtle'\"\n            :theme=\"getRow(itemName, titleField).color\"\n            size=\"md\"\n            :label=\"getRow(itemName, titleField).value\"\n          />\n        </div>\n        <div\n          v-else-if=\"getRow(itemName, titleField).label\"\n          class=\"truncate text-base\"\n        >\n          {{ getRow(itemName, titleField).label }}\n        </div>\n        <div class=\"text-gray-500\" v-else>{{ __('No Title') }}</div>\n      </div>\n    </template>\n\n    <template #fields=\"{ fieldName, itemName }\">\n      <div\n        v-if=\"getRow(itemName, fieldName).label\"\n        class=\"truncate flex items-center gap-2\"\n      >\n        <div v-if=\"fieldName === 'status'\">\n          <IndicatorIcon :class=\"getRow(itemName, fieldName).color\" />\n        </div>\n        <div v-else-if=\"fieldName === 'customer'\">\n          <Avatar\n            v-if=\"getRow(itemName, fieldName).label\"\n            class=\"flex items-center\"\n            :image=\"getRow(itemName, fieldName).logo\"\n            :label=\"getRow(itemName, fieldName).label\"\n            size=\"xs\"\n          />\n        </div>\n        <div v-else-if=\"fieldName === 'opportunity_owner'\">\n          <Avatar\n            v-if=\"getRow(itemName, fieldName).full_name\"\n            class=\"flex items-center\"\n            :image=\"getRow(itemName, fieldName).user_image\"\n            :label=\"getRow(itemName, fieldName).full_name\"\n            size=\"xs\"\n          />\n        </div>\n        <div\n          v-if=\"\n            [\n              'modified',\n              'creation',\n              'first_response_time',\n              'first_responded_on',\n              'response_by',\n            ].includes(fieldName)\n          \"\n          class=\"truncate text-base\"\n        >\n          <Tooltip :text=\"getRow(itemName, fieldName).label\">\n            <div>{{ getRow(itemName, fieldName).timeAgo }}</div>\n          </Tooltip>\n        </div>\n        <div v-else-if=\"fieldName === 'sla_status'\" class=\"truncate text-base\">\n          <Badge\n            v-if=\"getRow(itemName, fieldName).value\"\n            :variant=\"'subtle'\"\n            :theme=\"getRow(itemName, fieldName).color\"\n            size=\"md\"\n            :label=\"getRow(itemName, fieldName).value\"\n          />\n        </div>\n        <div v-else-if=\"fieldName === '_assign'\" class=\"flex items-center\">\n          <MultipleAvatar\n            :avatars=\"getRow(itemName, fieldName).label\"\n            size=\"xs\"\n          />\n        </div>\n        <div v-else class=\"truncate text-base\">\n          {{ getRow(itemName, fieldName).label }}\n        </div>\n      </div>\n    </template>\n\n    <template #actions=\"{ itemName }\">\n      <div class=\"flex gap-2 items-center justify-between\">\n        <div class=\"text-gray-600 flex items-center gap-1.5\">\n          <EmailAtIcon class=\"h-4 w-4\" />\n          <span v-if=\"getRow(itemName, '_email_count').label\">\n            {{ getRow(itemName, '_email_count').label }}\n          </span>\n          <span class=\"text-3xl leading-[0]\"> &middot; </span>\n          <NoteIcon class=\"h-4 w-4\" />\n          <span v-if=\"getRow(itemName, '_note_count').label\">\n            {{ getRow(itemName, '_note_count').label }}\n          </span>\n          <span class=\"text-3xl leading-[0]\"> &middot; </span>\n          <TaskIcon class=\"h-4 w-4\" />\n          <span v-if=\"getRow(itemName, '_task_count').label\">\n            {{ getRow(itemName, '_task_count').label }}\n          </span>\n          <span class=\"text-3xl leading-[0]\"> &middot; </span>\n          <CommentIcon class=\"h-4 w-4\" />\n          <span v-if=\"getRow(itemName, '_comment_count').label\">\n            {{ getRow(itemName, '_comment_count').label }}\n          </span>\n        </div>\n        <Dropdown\n          class=\"flex items-center gap-2\"\n          :options=\"actions(itemName)\"\n          variant=\"ghost\"\n          @click.stop.prevent\n        >\n          <Button icon=\"plus\" variant=\"ghost\" />\n        </Dropdown>\n      </div>\n    </template>\n  </KanbanView>\n  <OpportunitiesListView\n    ref=\"opportunitiesListView\"\n    v-else-if=\"opportunities.data && rows.length\"\n    v-model=\"opportunities.data.page_length_count\"\n    v-model:list=\"opportunities\"\n    :rows=\"rows\"\n    :columns=\"opportunities.data.columns\"\n    :options=\"{\n      showTooltip: false,\n      resizeColumn: true,\n      rowCount: opportunities.data.row_count,\n      totalCount: opportunities.data.total_count,\n    }\"\n    @loadMore=\"() => loadMore++\"\n    @columnWidthUpdated=\"() => triggerResize++\"\n    @updatePageCount=\"(count) => (updatedPageCount = count)\"\n    @applyFilter=\"(data) => viewControls.applyFilter(data)\"\n    @applyLikeFilter=\"(data) => viewControls.applyLikeFilter(data)\"\n    @likeDoc=\"(data) => viewControls.likeDoc(data)\"\n  />\n  <div v-else-if=\"opportunities.data\" class=\"flex h-full items-center justify-center\">\n    <div\n      class=\"flex flex-col items-center gap-3 text-xl font-medium text-gray-500\"\n    >\n      <OpportunitiesIcon class=\"h-10 w-10\" />\n      <span>{{ __('No {0} Found', [__('Opportunities')]) }}</span>\n      <Button :label=\"__('Create')\" @click=\"showOpportunityModal = true\">\n        <template #prefix><FeatherIcon name=\"plus\" class=\"h-4\" /></template>\n      </Button>\n    </div>\n  </div>\n  <OpportunityModal\n    v-if=\"showOpportunityModal\"\n    v-model=\"showOpportunityModal\"\n    v-model:quickEntry=\"showQuickEntryModal\"\n    :defaults=\"defaults\"\n  />\n  <NoteModal\n    v-if=\"showNoteModal\"\n    v-model=\"showNoteModal\"\n    :note=\"note\"\n    doctype=\"Opportunity\"\n    :doc=\"docname\"\n  />\n  <TaskModal\n    v-if=\"showTaskModal\"\n    v-model=\"showTaskModal\"\n    :task=\"task\"\n    doctype=\"Opportunity\"\n    :doc=\"docname\"\n  />\n  <QuickEntryModal\n    v-if=\"showQuickEntryModal\"\n    v-model=\"showQuickEntryModal\"\n    doctype=\"Opportunity\"\n  />\n</template>\n\n<script setup>\nimport ViewBreadcrumbs from '@/components/ViewBreadcrumbs.vue'\nimport MultipleAvatar from '@/components/MultipleAvatar.vue'\nimport CustomActions from '@/components/CustomActions.vue'\nimport EmailAtIcon from '@/components/Icons/EmailAtIcon.vue'\nimport PhoneIcon from '@/components/Icons/PhoneIcon.vue'\nimport NoteIcon from '@/components/Icons/NoteIcon.vue'\nimport TaskIcon from '@/components/Icons/TaskIcon.vue'\nimport CommentIcon from '@/components/Icons/CommentIcon.vue'\nimport IndicatorIcon from '@/components/Icons/IndicatorIcon.vue'\nimport OpportunitiesIcon from '@/components/Icons/OpportunitiesIcon.vue'\nimport LayoutHeader from '@/components/LayoutHeader.vue'\nimport OpportunitiesListView from '@/components/ListViews/OpportunitiesListView.vue'\nimport KanbanView from '@/components/Kanban/KanbanView.vue'\nimport OpportunityModal from '@/components/Modals/OpportunityModal.vue'\nimport NoteModal from '@/components/Modals/NoteModal.vue'\nimport TaskModal from '@/components/Modals/TaskModal.vue'\nimport QuickEntryModal from '@/components/Modals/QuickEntryModal.vue'\nimport ViewControls from '@/components/ViewControls.vue'\nimport { globalStore } from '@/stores/global'\nimport { usersStore } from '@/stores/users'\nimport { customersStore } from '@/stores/customers'\nimport { statusesStore } from '@/stores/statuses'\nimport { callEnabled } from '@/composables/settings'\nimport {\n  dateFormat,\n  dateTooltipFormat,\n  timeAgo,\n  website,\n  formatNumberIntoCurrency,\n  formatTime,\n} from '@/utils'\nimport { Tooltip, Avatar, Dropdown } from 'frappe-ui'\nimport { useRoute } from 'vue-router'\nimport { ref, reactive, computed, h } from 'vue'\n\nconst { makeCall } = globalStore()\nconst { getUser } = usersStore()\nconst { getCustomer } = customersStore()\nconst { getDealStatus } = statusesStore()\n\nconst route = useRoute()\n\nconst opportunitiesListView = ref(null)\nconst showOpportunityModal = ref(false)\nconst showQuickEntryModal = ref(false)\n\nconst defaults = reactive({})\n\n// opportunities data is loaded in the ViewControls component\nconst opportunities = ref({})\nconst loadMore = ref(1)\nconst triggerResize = ref(1)\nconst updatedPageCount = ref(20)\nconst viewControls = ref(null)\n\nfunction getRow(name, field) {\n  function getValue(value) {\n    if (value && typeof value === 'object' && !Array.isArray(value)) {\n      return value\n    }\n    return { label: value }\n  }\n  return getValue(rows.value?.find((row) => row.name == name)[field])\n}\n\n// Rows\nconst rows = computed(() => {\n  if (!opportunities.value?.data?.data) return []\n  if (opportunities.value.data.view_type === 'group_by') {\n    if (!opportunities.value?.data.group_by_field?.name) return []\n    return getGroupedByRows(\n      opportunities.value?.data.data,\n      opportunities.value?.data.group_by_field,\n    )\n  } else if (opportunities.value.data.view_type === 'kanban') {\n    return getKanbanRows(opportunities.value.data.data)\n  } else {\n    return parseRows(opportunities.value?.data.data)\n  }\n})\n\nfunction getGroupedByRows(listRows, groupByField) {\n  let groupedRows = []\n\n  groupByField.options?.forEach((option) => {\n    let filteredRows = []\n\n    if (!option) {\n      filteredRows = listRows.filter((row) => !row[groupByField.name])\n    } else {\n      filteredRows = listRows.filter((row) => row[groupByField.name] == option)\n    }\n\n    let groupDetail = {\n      label: groupByField.label,\n      group: option || __(' '),\n      collapsed: false,\n      rows: parseRows(filteredRows),\n    }\n    if (groupByField.name == 'status') {\n      groupDetail.icon = () =>\n        h(IndicatorIcon, {\n          class: getDealStatus(option)?.iconColorClass,\n        })\n    }\n    groupedRows.push(groupDetail)\n  })\n\n  return groupedRows || listRows\n}\n\nfunction getKanbanRows(data) {\n  let _rows = []\n  data.forEach((column) => {\n    column.data?.forEach((row) => {\n      _rows.push(row)\n    })\n  })\n  return parseRows(_rows)\n}\n\nfunction parseRows(rows) {\n  return rows.map((opportunity) => {\n    let _rows = {}\n    opportunities.value.data.rows.forEach((row) => {\n      _rows[row] = opportunity[row]\n\n      if (row == 'customer') {\n        _rows[row] = {\n          label: opportunity.customer,\n          logo: getCustomer(opportunity.customer)?.image,\n        }\n      } else if (row === 'website') {\n        _rows[row] = website(opportunity.website)\n      } else if (row == 'opportunity_amount') {\n        _rows[row] = formatNumberIntoCurrency(\n          opportunity.opportunity_amount,\n          opportunity.currency,\n        )\n      } else if (row == 'status') {\n        _rows[row] = {\n          label: opportunity.status,\n          color: getDealStatus(opportunity.status)?.iconColorClass,\n        }\n      } else if (row == 'sla_status') {\n        let value = opportunity.sla_status\n        let tooltipText = value\n        let color =\n          opportunity.sla_status == 'Failed'\n            ? 'red'\n            : opportunity.sla_status == 'Fulfilled'\n              ? 'green'\n              : 'orange'\n        if (value == 'First Response Due') {\n          value = __(timeAgo(opportunity.response_by))\n          tooltipText = dateFormat(opportunity.response_by, dateTooltipFormat)\n          if (new Date(opportunity.response_by) < new Date()) {\n            color = 'red'\n          }\n        }\n        _rows[row] = {\n          label: tooltipText,\n          value: value,\n          color: color,\n        }\n      } else if (row == 'opportunity_owner') {\n        _rows[row] = {\n          label: opportunity.opportunity_owner && getUser(opportunity.opportunity_owner).full_name,\n          ...(opportunity.opportunity_owner && getUser(opportunity.opportunity_owner)),\n        }\n      } else if (row == '_assign') {\n        let assignees = JSON.parse(opportunity._assign || '[]')\n        if (!assignees.length && opportunity.opportunity_owner) {\n          assignees = [opportunity.opportunity_owner]\n        }\n        _rows[row] = assignees.map((user) => ({\n          name: user,\n          image: getUser(user).user_image,\n          label: getUser(user).full_name,\n        }))\n      } else if (['modified', 'creation'].includes(row)) {\n        _rows[row] = {\n          label: dateFormat(opportunity[row], dateTooltipFormat),\n          timeAgo: __(timeAgo(opportunity[row])),\n        }\n      } else if (\n        ['first_response_time', 'first_responded_on', 'response_by'].includes(\n          row,\n        )\n      ) {\n        let field = row == 'response_by' ? 'response_by' : 'first_responded_on'\n        _rows[row] = {\n          label: opportunity[field] ? dateFormat(opportunity[field], dateTooltipFormat) : '',\n          timeAgo: opportunity[row]\n            ? row == 'first_response_time'\n              ? formatTime(opportunity[row])\n              : __(timeAgo(opportunity[row]))\n            : '',\n        }\n      }\n    })\n    _rows['_email_count'] = opportunity._email_count\n    _rows['_note_count'] = opportunity._note_count\n    _rows['_task_count'] = opportunity._task_count\n    _rows['_comment_count'] = opportunity._comment_count\n    return _rows\n  })\n}\n\nfunction onNewClick(column) {\n  let column_field = opportunities.value.params.column_field\n\n  if (column_field) {\n    defaults[column_field] = column.column.name\n  }\n\n  showOpportunityModal.value = true\n}\n\nfunction actions(itemName) {\n  let mobile_no = getRow(itemName, 'mobile_no')?.label || ''\n  let actions = [\n    {\n      icon: h(PhoneIcon, { class: 'h-4 w-4' }),\n      label: __('Make a Call'),\n      onClick: () => makeCall(mobile_no),\n      condition: () => mobile_no && callEnabled.value,\n    },\n    {\n      icon: h(NoteIcon, { class: 'h-4 w-4' }),\n      label: __('New Note'),\n      onClick: () => showNote(itemName),\n    },\n    {\n      icon: h(TaskIcon, { class: 'h-4 w-4' }),\n      label: __('New Task'),\n      onClick: () => showTask(itemName),\n    },\n  ]\n  return actions.filter((action) =>\n    action.condition ? action.condition() : true,\n  )\n}\n\nconst docname = ref('')\nconst showNoteModal = ref(false)\nconst note = ref({\n  title: '',\n  content: '',\n})\n\nfunction showNote(name) {\n  docname.value = name\n  showNoteModal.value = true\n}\n\nconst showTaskModal = ref(false)\nconst task = ref({\n  title: '',\n  description: '',\n  assigned_to: '',\n  due_date: '',\n  priority: 'Low',\n  status: 'Backlog',\n})\n\nfunction showTask(name) {\n  docname.value = name\n  showTaskModal.value = true\n}\n</script>\n"],"names":["props","__props","getUser","isManager","usersStore","getDealStatus","statusOptions","statusesStore","show","_useModel","router","useRouter","error","ref","opportunity","reactive","isOpportunityCreating","chooseExistingCustomer","sections","createResource","data","section","field","opportunityStatuses","filteredSections","computed","allSections","_filteredSections","s","statuses","createOpportunity","name","capture","err","showQuickEntryModal","openQuickEntryModal","nextTick","onMounted","makeCall","globalStore","getCustomer","customersStore","route","useRoute","opportunitiesListView","showOpportunityModal","defaults","opportunities","loadMore","triggerResize","updatedPageCount","viewControls","getRow","getValue","value","_a","rows","row","_b","_d","_c","getGroupedByRows","_e","_f","getKanbanRows","parseRows","_g","listRows","groupByField","groupedRows","option","filteredRows","groupDetail","h","IndicatorIcon","_rows","column","website","formatNumberIntoCurrency","tooltipText","color","timeAgo","dateFormat","dateTooltipFormat","assignees","user","formatTime","onNewClick","column_field","actions","itemName","mobile_no","PhoneIcon","callEnabled","NoteIcon","showNote","TaskIcon","showTask","action","docname","showNoteModal","note","showTaskModal","task"],"mappings":"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"}