import{_ as de,a as ce}from"./SidePanelModal-7a4a2300.js";import{_ as _e}from"./Section-3c95fd43.js";import{g as pe,S as fe,_ as be}from"./view-43ec0067.js";import{a as ge}from"./FadedScrollableDiv-10ee6cf2.js";import{_ as ye}from"./LayoutHeader-72a3cdee.js";import{_ as we}from"./QuickEntryModal-ebc5f118.js";import{_ as he}from"./AddressModal-e11ac707.js";import{_ as ve}from"./OpportunitiesListView-bab2c24d.js";import{_ as Ce}from"./ContactsListView-76da7066.js";import{W as ke}from"./WebsiteIcon-326f696e.js";import{E as xe}from"./views-5d4a0486.js";import{C as Ie}from"./CameraIcon-91addc5f.js";import{O as Ve}from"./OpportunitiesIcon-89f01f41.js";import{C as $e}from"./ContactsIcon-a70cc581.js";import{u as Fe,g as Le,h as Se,d as E,t as M,b as Be,_ as Oe,e as N,c as A}from"./index-b1bb6af7.js";import{s as Re}from"./statuses-6fc48ca5.js";import{l as b,h as Ue,v as je,J as Te,j as g,K as qe,x as Ee,B as D,L as P,r as $,b as s,c as y,u as a,g as d,w as m,p as u,e as r,d as n,F as z,I as L,G as S,C as Me,t as k,f as Ne,n as B,H as W}from"./index-8ca2d158.js";import{_ as Ae}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-28c0bac8.js";import{_ as De}from"./Dropdown.vue_vue_type_script_setup_true_lang-dba778cd.js";import{F as Pe}from"./FileUploader-e5eb09df.js";import"./DragVerticalIcon-523c4542.js";import"./Switch.vue_vue_type_script_setup_true_lang-cbc97d13.js";import"./ArrowUpRightIcon-c299f2a1.js";import"./Fields-02fbbc9b.js";import"./IndicatorIcon-367a8d49.js";import"./DatePicker-0e72d67e.js";import"./ListBulkActions-ccdc1c2a.js";import"./AssignmentModal-759f92c3.js";import"./PhoneIcon-42af6989.js";import"./ListRows-7339a2c3.js";import"./ListFooter-ed664a38.js";const ze={ref:"parentRef",class:"flex h-full"},We={class:"border-b"},Ge={class:"flex flex-col items-start justify-start gap-4 p-5"},Je={class:"flex gap-4 items-center"},He={class:"group relative h-15.5 w-15.5"},Ke={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Qe={class:"flex flex-col gap-2 truncate"},Xe={class:"truncate text-2xl font-medium"},Ye={key:0,class:"flex items-center gap-1.5 text-base text-gray-800"},Ze={class:"flex gap-1.5"},et={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},tt={class:"flex flex-col overflow-y-auto"},ot={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},at={class:"flex flex-col items-center justify-center space-y-3"},jt={__name:"Customer",props:{customerId:{type:String,required:!0}},setup(G){const i=G,{getUser:O,isManager:J}=Fe(),{$dialog:H}=Le(),{getDealStatus:K}=Re(),x=b(!1),F=b(!1),p=Ue(),Q=je(),l=Te({doctype:"Customer",name:i.customerId,cache:["customer",i.customerId],fields:["*"],auto:!0});async function X(e,t){await l.setValue.submit({[e]:t}),N({title:__("Customer updated"),icon:"check",iconClasses:"text-green-600"})}const Y=g(()=>{let e=[{label:__("Customers"),route:{name:"Customers"}}];if(p.query.view||p.query.viewType){let t=pe(p.query.view,p.query.viewType,"Customer");t&&e.push({label:__(t.label),icon:t.icon,route:{name:"Customers",params:{viewType:p.query.viewType},query:{view:p.query.view}}})}return e.push({label:i.customerId,route:{name:"Customer",params:{customerId:i.customerId}}}),e});qe(()=>({title:i.customerId}));function Z(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return __("Only PNG and JPG images are allowed")}async function R(e){await L("frappe.client.set_value",{doctype:"Customer",name:i.customerId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),l.reload()}async function ee(){H({title:__("Delete customer"),message:__("Are you sure you want to delete this customer?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await L("frappe.client.delete",{doctype:"Customer",name:i.customerId}),e(),Q.push({name:"Customers"})}}]})}function te(e){return e&&e.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")}function oe(){l.doc.website?window.open(l.doc.website,"_blank"):N({title:__("Website not found"),icon:"x",iconClasses:"text-red-600"})}const I=b(!1),ae=b({}),V=b({}),w=Ee({url:"next_crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",i.customerId],params:{doctype:"Customer",name:i.customerId},auto:!0,transform:e=>se(e)});function se(e){return e.map(t=>({...t,fields:g(()=>t.fields.map(c=>c.name==="address"?{...c,create:(f,C)=>{ae.value.address=f,V.value={},I.value=!0,C()},edit:async f=>{V.value=await L("frappe.client.get",{doctype:"Address",name:f}),I.value=!0}}:c))}))}const h=b(0),le=[{label:"Opportunities",icon:D(Ve,{class:"h-4 w-4"}),count:g(()=>{var e;return(e=U.data)==null?void 0:e.length})},{label:"Contacts",icon:D($e,{class:"h-4 w-4"}),count:g(()=>{var e;return(e=j.data)==null?void 0:e.length})}],U=P({type:"list",doctype:"Opportunity",cache:["opportunities",i.customerId],fields:["name","customer","currency","opportunity_amount","status","contact_email","contact_mobile","opportunity_owner","modified"],filters:{customer:i.customerId},orderBy:"modified desc",pageLength:20,auto:!0}),j=P({type:"list",doctype:"Contact",cache:["contacts",i.customerId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:i.customerId},orderBy:"modified desc",pageLength:20,auto:!0}),v=g(()=>{let e=[];return e=h.value?j:U,e.data?e.data.map(t=>h.value?ne(t):re(t)):[]}),T=g(()=>h.value===0?ie:me);function re(e){var t,c;return{name:e.name,customer:{label:e.customer,logo:(t=i.customer)==null?void 0:t.image},opportunity_amount:Se(e.opportunity_amount,e.currency),status:{label:e.status,color:(c=K(e.status))==null?void 0:c.iconColorClass},email:e.email,mobile_no:e.mobile_no,opportunity_owner:{label:e.opportunity_owner&&O(e.opportunity_owner).full_name,...e.opportunity_owner&&O(e.opportunity_owner)},modified:{label:E(e.modified,A),timeAgo:__(M(e.modified))}}}function ne(e){var t;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(t=i.customer)==null?void 0:t.image},modified:{label:E(e.modified,A),timeAgo:__(M(e.modified))}}}const ie=[{label:__("Customer"),key:"customer",width:"11rem"},{label:__("Amount"),key:"opportunity_amount",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"contact_email",width:"12rem"},{label:__("Mobile no"),key:"contact_mobile",width:"11rem"},{label:__("Opportunity owner"),key:"opportunity_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],me=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Customer"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,t)=>{const c=$("ErrorMessage"),f=$("FeatherIcon"),C=$("Button"),ue=$("Badge");return s(),y(z,null,[a(l).doc?(s(),d(ye,{key:0},{"left-header":m(()=>[n(a(Ae),{items:Y.value},{prefix:m(({item:o})=>[o.icon?(s(),d(ge,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):u("",!0)]),_:1},8,["items"])]),_:1})):u("",!0),r("div",ze,[a(l).doc?(s(),d(de,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:m(()=>[r("div",We,[n(a(Pe),{onSuccess:R,validateFile:Z},{default:m(({openFileSelector:o,error:_})=>[r("div",Ge,[r("div",Je,[r("div",He,[n(a(Be),{size:"3xl",class:"h-15.5 w-15.5",label:a(l).doc.customer_name,image:a(l).doc.image},null,8,["label","image"]),(s(),d(S(a(l).doc.image?a(De):"div"),Me(a(l).doc.image?{options:[{icon:"upload",label:a(l).doc.image?e.__("Change image"):e.__("Upload image"),onClick:o},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>R("")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:m(()=>[r("div",Ke,[n(Ie,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),r("div",Qe,[r("div",Xe,[r("span",null,k(a(l).doc.name),1)]),a(l).doc.website?(s(),y("div",Ye,[n(ke,{class:"size-4"}),r("span",null,k(te(a(l).doc.website)),1)])):u("",!0),n(c,{message:e.__(_)},null,8,["message"])])]),r("div",Ze,[n(C,{label:e.__("Delete"),theme:"red",size:"sm",onClick:ee},{prefix:m(()=>[n(f,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"]),n(a(Oe),{text:e.__("Open website")},{default:m(()=>[r("div",null,[n(C,{onClick:oe},{default:m(()=>[n(f,{name:"link",class:"h-4 w-4"})]),_:1})])]),_:1},8,["text"])])])]),_:1})]),a(w).data?(s(),y("div",et,[r("div",tt,[(s(!0),y(z,null,Ne(a(w).data,(o,_)=>(s(),y("div",{key:o.label,class:B(["flex flex-col p-3",{"border-b":_!==a(w).data.length-1}])},[n(_e,{"is-opened":o.opened,label:o.label},{actions:m(()=>[_==0&&a(J)()?(s(),d(C,{key:0,variant:"ghost",class:"w-7",onClick:t[0]||(t[0]=q=>x.value=!0)},{default:m(()=>[n(xe,{class:"h-4 w-4"})]),_:1})):u("",!0)]),default:m(()=>[o.fields?(s(),d(fe,{key:0,fields:o.fields,isLastSection:_==a(w).data.length-1,modelValue:a(l).doc,"onUpdate:modelValue":t[1]||(t[1]=q=>a(l).doc=q),onUpdate:X},null,8,["fields","isLastSection","modelValue"])):u("",!0)]),_:2},1032,["is-opened","label"])],2))),128))])])):u("",!0)]),_:1},8,["parent"])):u("",!0),n(a(be),{class:"overflow-hidden",modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=o=>h.value=o),tabs:le},{tab:m(({tab:o,selected:_})=>[r("button",{class:B(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":_}])},[o.icon?(s(),d(S(o.icon),{key:0,class:"h-5"})):u("",!0),W(" "+k(e.__(o.label))+" ",1),n(ue,{class:B(["group-hover:bg-gray-900",[_?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:m(()=>[W(k(o.count),1)]),_:2},1032,["class"])],2)]),default:m(({tab:o})=>[o.label==="Opportunities"&&v.value.length?(s(),d(ve,{key:0,class:"mt-4",rows:v.value,columns:T.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):u("",!0),o.label==="Contacts"&&v.value.length?(s(),d(Ce,{key:1,class:"mt-4",rows:v.value,columns:T.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):u("",!0),v.value.length?u("",!0):(s(),y("div",ot,[r("div",at,[(s(),d(S(o.icon),{class:"!h-10 !w-10"})),r("div",null,k(e.__("No {0} Found",[e.__(o.label)])),1)])]))]),_:1},8,["modelValue"])],512),x.value?(s(),d(ce,{key:1,modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=o=>x.value=o),doctype:"Customer",onReload:t[4]||(t[4]=()=>a(w).reload())},null,8,["modelValue"])):u("",!0),F.value?(s(),d(we,{key:2,modelValue:F.value,"onUpdate:modelValue":t[5]||(t[5]=o=>F.value=o),doctype:"Customer"},null,8,["modelValue"])):u("",!0),n(he,{modelValue:I.value,"onUpdate:modelValue":t[6]||(t[6]=o=>I.value=o),address:V.value,"onUpdate:address":t[7]||(t[7]=o=>V.value=o)},null,8,["modelValue","address"])],64)}}};export{jt as default};
//# sourceMappingURL=Customer-bab0dfbb.js.map
