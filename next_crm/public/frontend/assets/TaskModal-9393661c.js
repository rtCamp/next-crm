import{u as z,m as L,n as P,a as b,_ as R,l as A,B as J}from"./index-b1bb6af7.js";import{A as N}from"./ArrowUpRightIcon-c299f2a1.js";import{T as E,_ as q,D as F}from"./views-5d4a0486.js";import{_ as G,m as h,i as w,v as H,l as _,a as K,k as Q,r as v,b as T,g as x,w as l,e as r,t as f,d as o,p as W,u as i,I as V,z as X,A as Y}from"./index-8ca2d158.js";import{_ as M}from"./Dropdown.vue_vue_type_script_setup_true_lang-dba778cd.js";const Z={class:"flex items-center gap-3"},ee={class:"text-2xl font-semibold leading-6 text-gray-900"},ae={class:"flex flex-col gap-4"},te={class:"mb-1.5 text-sm text-gray-600"},se={class:"mb-1.5 text-sm text-gray-600"},oe={class:"flex flex-wrap items-center gap-2"},le={class:"cursor-pointer"},ne={__name:"TaskModal",props:h({task:{type:Object,default:{}},doctype:{type:String,default:"Lead"},doc:{type:String,default:""}},{modelValue:{},modelModifiers:{},reloadTasks:{},reloadTasksModifiers:{}}),emits:h(["updateTask","after"],["update:modelValue","update:reloadTasks"]),setup(d,{emit:C}){const u=d,c=w(d,"modelValue"),y=w(d,"reloadTasks"),O=C,D=H(),{getUser:m}=z(),k=_(null),p=_(!1),a=_({title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:u.doctype,reference_docname:null});function B(e){a.value.status=e}function I(e){a.value.priority=e}function U(){var n;if(!((n=u.task)!=null&&n.reference_docname))return;let e=u.task.reference_doctype=="Opportunity"?"Opportunity":"Lead",t={leadId:u.task.reference_docname};e=="Opportunity"&&(t={opportunityId:u.task.reference_docname}),D.push({name:e,params:t})}async function $(){a.value.assigned_to||(a.value.assigned_to=m().name),a.value.name?(await V("frappe.client.set_value",{doctype:"CRM Task",name:a.value.name,fieldname:a.value})).name&&y.value.reload():(await V("frappe.client.insert",{doc:{doctype:"CRM Task",reference_doctype:u.doctype,reference_docname:u.doc||null,...a.value}})).name&&(X("task_created"),y.value.reload(),O("after")),c.value=!1}function g(){p.value=!1,Y(()=>{var e,t,n;(n=(t=(e=k.value)==null?void 0:e.el)==null?void 0:t.focus)==null||n.call(t),a.value={...u.task},a.value.title&&(p.value=!0)})}return K(()=>c.value&&g()),Q(c,e=>{e&&g()}),(e,t)=>{const n=v("Button"),S=v("TextInput"),j=v("Dialog");return T(),x(j,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=s=>c.value=s),options:{size:"xl",actions:[{label:p.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>$()}]}},{"body-title":l(()=>{var s;return[r("div",Z,[r("h3",ee,f(p.value?e.__("Edit Task"):e.__("Create Task")),1),(s=d.task)!=null&&s.reference_docname?(T(),x(n,{key:0,variant:"outline",size:"sm",label:d.task.reference_doctype=="Opportunity"?e.__("Open Opportunity"):e.__("Open Lead"),onClick:t[0]||(t[0]=re=>U())},{suffix:l(()=>[o(N,{class:"h-4 w-4"})]),_:1},8,["label"])):W("",!0)])]}),"body-content":l(()=>[r("div",ae,[r("div",null,[r("div",te,f(e.__("Title")),1),o(S,{ref_key:"title",ref:k,variant:"outline",modelValue:a.value.title,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.title=s),placeholder:e.__("Call with John Doe")},null,8,["modelValue","placeholder"])]),r("div",null,[r("div",se,f(e.__("Description")),1),o(i(E),{variant:"outline",ref:"description","editor-class":"!prose-sm overflow-auto min-h-[80px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:a.value.description,onChange:t[2]||(t[2]=s=>a.value.description=s),placeholder:e.__("Took a call with John Doe and discussed the new project.")},null,8,["content","placeholder"])]),r("div",oe,[o(i(M),{options:i(P)(B)},{default:l(()=>[o(n,{label:a.value.status,class:"w-full justify-between"},{prefix:l(()=>[o(L,{status:a.value.status},null,8,["status"])]),_:1},8,["label"])]),_:1},8,["options"]),o(q,{class:"form-control",value:i(m)(a.value.assigned_to).full_name,doctype:"User",onChange:t[3]||(t[3]=s=>a.value.assigned_to=s),placeholder:e.__("John Doe"),hideMe:!0},{prefix:l(()=>[o(b,{class:"mr-2 !h-4 !w-4",user:a.value.assigned_to},null,8,["user"])]),"item-prefix":l(({option:s})=>[o(b,{class:"mr-2",user:s.value,size:"sm"},null,8,["user"])]),"item-label":l(({option:s})=>[o(i(R),{text:s.value},{default:l(()=>[r("div",le,f(i(m)(s.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["value","placeholder"]),o(i(F),{class:"datepicker w-36",modelValue:a.value.due_date,"onUpdate:modelValue":t[4]||(t[4]=s=>a.value.due_date=s),placeholder:e.__("01/04/2024 11:30 PM"),"input-class":"border-none"},null,8,["modelValue","placeholder"]),o(i(M),{options:i(J)(I)},{default:l(()=>[o(n,{label:a.value.priority,class:"w-full justify-between"},{prefix:l(()=>[o(A,{priority:a.value.priority},null,8,["priority"])]),_:1},8,["label"])]),_:1},8,["options"])])])]),_:1},8,["modelValue","options"])}}},fe=G(ne,[["__scopeId","data-v-52cdfd55"]]);export{fe as T};
//# sourceMappingURL=TaskModal-9393661c.js.map
