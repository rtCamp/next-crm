import{a as ce}from"./FadedScrollableDiv-10ee6cf2.js";import{_ as me}from"./Section-3c95fd43.js";import{g as de,S as ue,_ as _e}from"./view-43ec0067.js";import{_ as pe}from"./LayoutHeader-72a3cdee.js";import{D as fe}from"./DetailsIcon-14f9b41c.js";import{P as ge}from"./PhoneIcon-42af6989.js";import{C as he}from"./CameraIcon-91addc5f.js";import{O as ve}from"./OpportunitiesIcon-89f01f41.js";import{_ as ye}from"./OpportunitiesListView-bab2c24d.js";import{_ as be}from"./AddressModal-e11ac707.js";import{g as we,u as Ce,e as k,h as xe,d as ke,t as Ie,b as H,c as Se}from"./index-b1bb6af7.js";import{c as Ve}from"./customers-8d8733e3.js";import{s as De}from"./statuses-6fc48ca5.js";import{c as Fe}from"./settings-9f3d7d3a.js";import{h as Oe,v as $e,l as j,x as B,j as I,K as je,B as Ne,r as N,b as r,c as g,u as n,g as h,w as f,p as u,d as c,F as J,I as v,e as d,C as Pe,G as q,t as S,n as T,H as K,f as Be}from"./index-8ca2d158.js";import{_ as qe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-28c0bac8.js";import{_ as Te}from"./Dropdown.vue_vue_type_script_setup_true_lang-dba778cd.js";import{F as Ue}from"./FileUploader-e5eb09df.js";import"./views-5d4a0486.js";import"./ArrowUpRightIcon-c299f2a1.js";import"./ListBulkActions-ccdc1c2a.js";import"./DatePicker-0e72d67e.js";import"./AssignmentModal-759f92c3.js";import"./IndicatorIcon-367a8d49.js";import"./ListRows-7339a2c3.js";import"./ListFooter-ed664a38.js";import"./QuickEntryModal-ebc5f118.js";import"./Fields-02fbbc9b.js";import"./DragVerticalIcon-523c4542.js";import"./Switch.vue_vue_type_script_setup_true_lang-cbc97d13.js";const ze={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},Ae={key:1,class:"flex flex-col h-full overflow-hidden"},Ee={class:"flex flex-col items-start justify-start gap-4 p-4"},Le={class:"flex gap-4 items-center"},Me={class:"group relative h-14.5 w-14.5"},Re={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Ge={class:"flex flex-col gap-2 truncate"},He={class:"truncate text-lg font-medium"},Je={key:0},Ke={class:"flex items-center gap-1.5"},Qe={key:0},We={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},Xe={class:"flex flex-col overflow-y-auto"},Ye={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},Ze={class:"flex flex-col items-center justify-center space-y-3"},Oa={__name:"MobileContact",props:{contactId:{type:String,required:!0}},setup(Q){const{$dialog:W,makeCall:X}=we(),{getUser:U}=Ce(),{getCustomer:z}=Ve(),{getDealStatus:Y}=De(),_=Q,b=Oe(),Z=$e(),V=j(!1),m=j({}),D=j({}),a=B({url:"next_crm.api.contact.get_contact",cache:["contact",_.contactId],params:{name:_.contactId},auto:!0,transform:e=>({...e,actual_mobile_no:e.mobile_no,mobile_no:e.mobile_no})}),ee=I(()=>{var t;let e=[{label:__("Contacts"),route:{name:"Contacts"}}];if(b.query.view||b.query.viewType){let i=de(b.query.view,b.query.viewType,"Contact");i&&e.push({label:__(i.label),icon:i.icon,route:{name:"Contacts",params:{viewType:b.query.viewType},query:{view:b.query.view}}})}return e.push({label:(t=a.data)==null?void 0:t.full_name,route:{name:"Contact",params:{contactId:_.contactId}}}),e});je(()=>{var e,t;return{title:((e=a.data)==null?void 0:e.full_name)||((t=a.data)==null?void 0:t.name)}});function ae(e){let t=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(t))return __("Only PNG and JPG images are allowed")}async function A(e){await v("frappe.client.set_value",{doctype:"Contact",name:_.contactId,fieldname:"image",value:(e==null?void 0:e.file_url)||""}),a.reload()}async function te(){W({title:__("Delete contact"),message:__("Are you sure you want to delete this contact?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await v("frappe.client.delete",{doctype:"Contact",name:_.contactId}),e(),Z.push({name:"Contacts"})}}]})}const E=j(0),oe=[{name:"Details",label:__("Details"),icon:fe},{name:"Opportunities",label:__("Opportunities"),icon:Ne(ve,{class:"h-4 w-4"}),count:I(()=>{var e;return(e=F.data)==null?void 0:e.length})}],F=B({url:"next_crm.api.contact.get_linked_opportunities",cache:["opportunities",_.contactId],params:{contact:_.contactId},auto:!0}),P=I(()=>!F.data||F.data==[]?[]:F.data.map(e=>ie(e))),O=B({url:"next_crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",_.contactId],params:{doctype:"Contact",name:_.contactId},auto:!0,transform:e=>le(e)});function le(e){return e.map(t=>({...t,fields:I(()=>t.fields.map(i=>{var w,C,$,s;return i.name==="email_id"?{...i,type:"dropdown",options:((C=(w=a.data)==null?void 0:w.email_ids)==null?void 0:C.map(o=>({name:o.name,value:o.email_id,selected:o.email_id===a.data.email_id,placeholder:"john@doe.com",onClick:()=>{m.value.email_id=o.email_id,L("email",o.email_id)},onSave:(l,p)=>{p?(M("email",l.value),a.data.email_ids.length===1&&(m.value.email_id=l.value)):R("Contact Email",l.name,"email_id",l.value)},onDelete:async(l,p)=>{var x;a.data.email_ids=a.data.email_ids.filter(y=>y.name!==l.name),!p&&await G("Contact Email",l.name),m.value.email_id===l.value&&(a.data.email_ids.length===0?m.value.email_id="":m.value.email_id=(x=a.data.email_ids.find(y=>y.is_primary))==null?void 0:x.email_id)}})))||[],create:()=>{var o,l;(l=(o=a.data)==null?void 0:o.email_ids)==null||l.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:i.name==="mobile_no"?{...i,type:"dropdown",options:((s=($=a.data)==null?void 0:$.phone_nos)==null?void 0:s.map(o=>({name:o.name,value:o.phone,selected:o.phone===a.data.actual_mobile_no,onClick:()=>{m.value.actual_mobile_no=o.phone,m.value.mobile_no=o.phone,L("mobile_no",o.phone)},onSave:(l,p)=>{p?(M("phone",l.value),a.data.phone_nos.length===1&&(m.value.actual_mobile_no=l.value)):R("Contact Phone",l.name,"phone",l.value)},onDelete:async(l,p)=>{var x;a.data.phone_nos=a.data.phone_nos.filter(y=>y.name!==l.name),!p&&await G("Contact Phone",l.name),m.value.actual_mobile_no===l.value&&(a.data.phone_nos.length===0?m.value.actual_mobile_no="":m.value.actual_mobile_no=(x=a.data.phone_nos.find(y=>y.is_primary_mobile_no))==null?void 0:x.phone)}})))||[],create:()=>{var o,l;(l=(o=a.data)==null?void 0:o.phone_nos)==null||l.push({name:"new-1",value:"",selected:!1,isNew:!0})}}:i.name==="address"?{...i,create:(o,l)=>{m.value.address=o,D.value={},V.value=!0,l()},edit:async o=>{D.value=await v("frappe.client.get",{doctype:"Address",name:o}),V.value=!0}}:i}))}))}async function L(e,t){await v("next_crm.api.contact.set_as_primary",{contact:a.data.name,field:e,value:t})&&(a.reload(),k({title:"Contact updated",icon:"check",iconClasses:"text-green-600"}))}async function M(e,t){if(!t)return;await v("next_crm.api.contact.create_new",{contact:a.data.name,field:e,value:t})&&(a.reload(),k({title:"Contact updated",icon:"check",iconClasses:"text-green-600"}))}async function R(e,t,i,w){await v("frappe.client.set_value",{doctype:e,name:t,fieldname:i,value:w})&&(a.reload(),k({title:"Contact updated",icon:"check",iconClasses:"text-green-600"}))}async function G(e,t){await v("frappe.client.delete",{doctype:e,name:t}),await a.reload(),k({title:"Contact updated",icon:"check",iconClasses:"text-green-600"})}async function ne(e,t){await v("frappe.client.set_value",{doctype:"Contact",name:_.contactId,fieldname:e,value:t}),k({title:"Contact updated",icon:"check",iconClasses:"text-green-600"}),a.reload()}const se=I(()=>re);function ie(e){var t,i;return{name:e.name,customer:{label:e.customer,logo:(t=z(e.customer))==null?void 0:t.image},opportunity_amount:xe(e.opportunity_amount,e.currency),status:{label:e.status,color:(i=Y(e.status))==null?void 0:i.iconColorClass},email:e.email,mobile_no:e.mobile_no,opportunity_owner:{label:e.opportunity_owner&&U(e.opportunity_owner).full_name,...e.opportunity_owner&&U(e.opportunity_owner)},modified:{label:ke(e.modified,Se),timeAgo:__(Ie(e.modified))}}}const re=[{label:__("Customer"),key:"customer",width:"11rem"},{label:__("Amount"),key:"opportunity_amount",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"contact_email",width:"12rem"},{label:__("Mobile no"),key:"contact_mobile",width:"11rem"},{label:__("Opportunity owner"),key:"opportunity_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,t)=>{const i=N("Button"),w=N("FeatherIcon"),C=N("ErrorMessage"),$=N("Badge");return r(),g(J,null,[n(a).data?(r(),h(pe,{key:0},{default:f(()=>[d("header",ze,[c(n(qe),{items:ee.value},{prefix:f(({item:s})=>[s.icon?(r(),h(ce,{key:0,icon:s.icon,class:"mr-2 h-4"},null,8,["icon"])):u("",!0)]),_:1},8,["items"])])]),_:1})):u("",!0),n(a).data?(r(),g("div",Ae,[c(n(Ue),{onSuccess:A,validateFile:ae},{default:f(({openFileSelector:s,error:o})=>{var l;return[d("div",Ee,[d("div",Le,[d("div",Me,[c(n(H),{size:"3xl",class:"h-14.5 w-14.5",label:n(a).data.full_name,image:n(a).data.image},null,8,["label","image"]),(r(),h(q(n(a).data.image?n(Te):"div"),Pe(n(a).data.image?{options:[{icon:"upload",label:n(a).data.image?e.__("Change image"):e.__("Upload image"),onClick:s},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>A("")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:f(()=>[d("div",Re,[c(he,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),d("div",Ge,[d("div",He,[n(a).data.salutation?(r(),g("span",Je,S(n(a).data.salutation+". "),1)):u("",!0),d("span",null,S(n(a).data.full_name),1)]),d("div",Ke,[n(a).data.actual_mobile_no?(r(),h(i,{key:0,label:e.__("Make Call"),size:"sm",onClick:t[0]||(t[0]=p=>n(Fe)&&n(X)(n(a).data.actual_mobile_no))},{prefix:f(()=>[c(ge,{class:"h-4 w-4"})]),_:1},8,["label"])):u("",!0),c(i,{label:e.__("Delete"),theme:"red",size:"sm",onClick:te},{prefix:f(()=>[c(w,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"]),n(a).data.company_name?(r(),h(n(H),{key:1,size:"md",label:n(a).data.company_name,image:(l=n(z)(n(a).data.company_name))==null?void 0:l.image},null,8,["label","image"])):u("",!0)]),c(C,{message:e.__(o)},null,8,["message"])])])])]}),_:1}),c(n(_e),{modelValue:E.value,"onUpdate:modelValue":t[2]||(t[2]=s=>E.value=s),tabs:oe,tablistClass:"!px-4",class:"overflow-auto"},{tab:f(({tab:s,selected:o})=>[s.name=="Opportunities"?(r(),g("button",{key:0,class:T(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":o}])},[s.icon?(r(),h(q(s.icon),{key:0,class:"h-5"})):u("",!0),K(" "+S(e.__(s.label))+" ",1),c($,{class:T(["group-hover:bg-gray-900",[o?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:f(()=>[K(S(s.count),1)]),_:2},1032,["class"])],2)):u("",!0)]),default:f(({tab:s})=>[s.name=="Details"?(r(),g("div",Qe,[n(O).data?(r(),g("div",We,[d("div",Xe,[(r(!0),g(J,null,Be(n(O).data,(o,l)=>(r(),g("div",{key:o.label,class:T(["flex flex-col px-2 py-3 sm:p-3",{"border-b":l!==n(O).data.length-1}])},[c(me,{"is-opened":o.opened,label:o.label},{default:f(()=>[c(ue,{fields:o.fields,isLastSection:l==n(O).data.length-1,modelValue:n(a).data,"onUpdate:modelValue":t[1]||(t[1]=p=>n(a).data=p),onUpdate:ne},null,8,["fields","isLastSection","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):u("",!0)])):s.label==="Opportunities"&&P.value.length?(r(),h(ye,{key:1,class:"mt-4",rows:P.value,columns:se.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):u("",!0),s.label==="Opportunities"&&!P.value.length?(r(),g("div",Ye,[d("div",Ze,[(r(),h(q(s.icon),{class:"!h-10 !w-10"})),d("div",null,S(e.__("No {0} Found",[e.__(s.label)])),1)])])):u("",!0)]),_:1},8,["modelValue"])])):u("",!0),c(be,{modelValue:V.value,"onUpdate:modelValue":t[3]||(t[3]=s=>V.value=s),address:D.value,"onUpdate:address":t[4]||(t[4]=s=>D.value=s)},null,8,["modelValue","address"])],64)}}};export{Oa as default};
//# sourceMappingURL=MobileContact-2822ba14.js.map
