import{F as K}from"./Fields-02fbbc9b.js";import{_ as X}from"./AddressModal-e11ac707.js";import{E as Y}from"./views-5d4a0486.js";import{_ as R,b as n,c as i,e as o,m as Z,v as ee,i as $,l as c,j as V,B as F,D as E,x as te,I as g,k as ae,r as j,d as h,w as I,t as q,u as k,g as x,p as B,F as S,f as O,G as se,C as le,M as oe,z as ne,A as U}from"./index-8ca2d158.js";import{W as re}from"./WebsiteIcon-326f696e.js";import{C as ue}from"./CustomersIcon-c98fca89.js";import{u as ce,h as ie}from"./index-b1bb6af7.js";const de={},me={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-circle-dollar-sign"},ve=o("circle",{cx:"12",cy:"12",r:"10"},null,-1),_e=o("path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"},null,-1),fe=o("path",{d:"M12 18V6"},null,-1),pe=[ve,_e,fe];function he(m,v){return n(),i("svg",me,pe)}const ye=R(de,[["render",he]]),we={},ge={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-land-plot"},ke=o("path",{d:"m12 8 6-3-6-3v10"},null,-1),xe=o("path",{d:"m8 11.99-5.5 3.14a1 1 0 0 0 0 1.74l8.5 4.86a2 2 0 0 0 2 0l8.5-4.86a1 1 0 0 0 0-1.74L16 12"},null,-1),Ce=o("path",{d:"m6.49 12.85 11.02 6.3"},null,-1),be=o("path",{d:"M17.51 12.85 6.5 19.15"},null,-1),Me=[ke,xe,Ce,be];function $e(m,v){return n(),i("svg",ge,Me)}const Ve=R(we,[["render",$e]]),Ee={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},Ie={class:"mb-5 flex items-center justify-between"},Be={class:"text-2xl font-semibold leading-6 text-gray-900"},Se={class:"flex items-center gap-1"},De={key:0,class:"flex flex-col gap-3.5"},Ne={class:"grid w-7 place-content-center"},Fe={key:0,class:"px-4 pb-7 pt-4 sm:px-6"},je={class:"space-y-2"},Je={__name:"CustomerModal",props:Z({options:{type:Object,default:{redirect:!0,detailMode:!1,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{},customer:{},customerModifiers:{},quickEntry:{},quickEntryModifiers:{}}),emits:["update:modelValue","update:customer","update:quickEntry"],setup(m){const v=m,{isManager:A}=ce(),Q=ee(),d=$(m,"modelValue"),C=$(m,"customer"),f=c(!1);c(null);const u=c(!1),p=c(!1);let _=c({}),s=c({customer_name:"",website:"",annual_revenue:"",no_of_employees:"1-10",industry:""});const y=c(!1);let w=c({});async function z(){const t={...w.value},e={...s.value},l=t.customer_name!==e.customer_name;delete t.customer_name,delete e.customer_name;const r=JSON.stringify(t)!==JSON.stringify(e),a=e;if(!l&&!r){d.value=!1;return}let M;f.value=!0,l&&(M=await J()),r&&(M=await L(a)),D({name:M},l)}async function J(){var e;const t=await g("frappe.client.rename_doc",{doctype:"Customer",old_name:(e=w.value)==null?void 0:e.customer_name,new_name:s.value.customer_name});return f.value=!1,t}async function L(t){const e=await g("frappe.client.set_value",{doctype:"Customer",name:s.value.name,fieldname:t});return f.value=!1,e.name}async function T(){const t=await g("frappe.client.insert",{doc:{doctype:"Customer",...s.value}});f.value=!1,t.name&&(ne("customer_created"),D(t))}function D(t,e=!1){var l,r;t.name&&(v.options.redirect||e)?Q.push({name:"Customer",params:{customerId:t.name}}):(r=(l=C.value).reload)==null||r.call(l),d.value=!1,v.options.afterInsert&&v.options.afterInsert(t)}const b=V(()=>{let t=p.value?__(s.value.customer_name):__("New Customer"),e=u.value?"":"xl",l=u.value?[]:[{label:p.value?__("Save"):__("Create"),variant:"solid",onClick:()=>p.value?z():T()}];return{title:t,size:e,actions:l}}),W=V(()=>[{icon:ue,name:"customer_name",value:s.value.customer_name},{icon:re,name:"website",value:s.value.website},{icon:Ve,name:"territory",value:s.value.territory},{icon:ye,name:"annual_revenue",value:ie(s.value.annual_revenue,s.value.currency)},{icon:F(E,{name:"hash",class:"h-4 w-4"}),name:"no_of_employees",value:s.value.no_of_employees},{icon:F(E,{name:"briefcase",class:"h-4 w-4"}),name:"industry",value:s.value.industry}].filter(e=>e.value)),G=te({url:"next_crm.ncrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["quickEntryFields","Customer"],params:{doctype:"Customer",type:"Quick Entry"},auto:!0}),N=V(()=>{let t=G.data||[];return t.length?(t.forEach(e=>{e.fields.forEach(l=>{l.name=="address"&&(l.create=(r,a)=>{s.value.address=r,_.value={},y.value=!0,a()},l.edit=async r=>{_.value=await g("frappe.client.get",{doctype:"Address",name:r}),y.value=!0})})}),t):[]});ae(()=>d.value,t=>{t&&(p.value=!1,u.value=v.options.detailMode,U(()=>{var e;w.value=((e=C.value)==null?void 0:e.doc)||C.value||{},s.value={...w.value},s.value.name&&(p.value=!0)}))});const H=$(m,"quickEntry");function P(){H.value=!0,U(()=>{d.value=!1})}return(t,e)=>{const l=j("Button"),r=j("Dialog");return n(),i(S,null,[h(r,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value=a),options:b.value},{body:I(()=>[o("div",Ee,[o("div",Ie,[o("div",null,[o("h3",Be,q(t.__(b.value.title)||t.__("Untitled")),1)]),o("div",Se,[k(A)()||u.value?(n(),x(l,{key:0,variant:"ghost",class:"w-7",onClick:e[0]||(e[0]=a=>u.value?u.value=!1:P())},{default:I(()=>[h(Y,{class:"h-4 w-4"})]),_:1})):B("",!0),h(l,{variant:"ghost",class:"w-7",onClick:e[1]||(e[1]=a=>d.value=!1)},{default:I(()=>[h(k(E),{name:"x",class:"h-4 w-4"})]),_:1})])]),o("div",null,[u.value?(n(),i("div",De,[(n(!0),i(S,null,O(W.value,a=>(n(),i("div",{class:"flex h-7 items-center gap-2 text-base text-gray-800",key:a.name},[o("div",Ne,[(n(),x(se(a.icon)))]),o("div",null,q(a.value),1)]))),128))])):N.value?(n(),x(K,{key:1,sections:N.value,data:k(s)},null,8,["sections","data"])):B("",!0)])]),u.value?B("",!0):(n(),i("div",Fe,[o("div",je,[(n(!0),i(S,null,O(b.value.actions,a=>(n(),x(l,le({class:"w-full",key:a.label},a,{label:t.__(a.label),loading:f.value}),null,16,["label","loading"]))),128))])]))]),_:1},8,["modelValue","options"]),h(X,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),address:k(_),"onUpdate:address":e[4]||(e[4]=a=>oe(_)?_.value=a:_=a)},null,8,["modelValue","address"])],64)}}};export{Je as _};
//# sourceMappingURL=CustomerModal-0ca69a84.js.map
