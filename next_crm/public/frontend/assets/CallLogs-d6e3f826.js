import{_ as J,a as G}from"./ViewControls-5fb3bbce.js";import{_ as K}from"./CustomActions-d5b79d4f.js";import{P as Q}from"./PhoneIcon-42af6989.js";import{_ as X}from"./LayoutHeader-72a3cdee.js";import{m as P,i as R,j as z,s as Y,k as j,l as k,r as I,b as n,c as i,d as r,w as d,u as f,F as A,f as T,g as b,n as D,p as L,e as v,t as V,q as ee,C as le,_ as E,v as oe,B as S,D as N,E as te,G as ae,H as ne,I as se,J as W}from"./index-8ca2d158.js";import{_ as re,H as O,a as ie,f as ue,b as ce,g as de,c as me,d as pe,e as ve}from"./ListBulkActions-ccdc1c2a.js";import{b as H,_ as q}from"./index-b1bb6af7.js";import{_ as _e}from"./Dropdown.vue_vue_type_script_setup_true_lang-dba778cd.js";import{_ as fe}from"./ListFooter-ed664a38.js";import{A as ge}from"./ArrowUpRightIcon-c299f2a1.js";import{D as ye,g as Z}from"./callLog-6b45f0c6.js";import{C as Ce}from"./ContactsIcon-a70cc581.js";import{L as ke}from"./LeadsIcon-81572691.js";import{O as he}from"./OpportunitiesIcon-89f01f41.js";import{C as we}from"./CalendarIcon-6dc7ec06.js";import{N as be,_ as Le}from"./NoteModal-6fe04093.js";import{_ as xe}from"./FadedScrollableDiv-10ee6cf2.js";import"./IconPicker-b2d84813.js";import"./views-5d4a0486.js";import"./DatePicker-0e72d67e.js";import"./PinIcon-0747ea14.js";import"./settings-9f3d7d3a.js";import"./DetailsIcon-14f9b41c.js";import"./DragVerticalIcon-523c4542.js";import"./AssignmentModal-759f92c3.js";import"./contacts-690888e4.js";const $e={key:0},Ve={key:1},Me=["onClick"],Ue={key:1,class:"truncate text-base"},Fe={key:2},Ie={key:3},Ae=["onClick"],Be={__name:"CallLogsListView",props:P({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:P(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc"],["update:modelValue","update:list"]),setup(c,{expose:w,emit:u}){const m=u,h=R(c,"modelValue"),y=R(c,"list"),s=z(()=>{var o,t;return!!((t=(o=y.value.params)==null?void 0:o.filters)!=null&&t._liked_by)}),{user:U}=Y();function x(o){if(o)return JSON.parse(o).includes(U)}j(h,(o,t)=>{o!==t&&m("updatePageCount",o)});const _=k(null);return w({customListActions:z(()=>{var o;return(o=_.value)==null?void 0:o.customListActions})}),(o,t)=>{const l=I("Button"),a=I("FeatherIcon"),F=I("Badge"),M=I("FormControl");return n(),i(A,null,[r(f(pe),le({columns:c.columns,rows:c.rows,options:{onRowClick:e=>m("showCallLog",e.name),selectable:c.options.selectable,showTooltip:c.options.showTooltip,resizeColumn:c.options.resizeColumn},"row-key":"name"},o.$attrs),{default:d(()=>[r(f(re),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:t[1]||(t[1]=e=>m("columnWidthUpdated"))},{default:d(()=>[(n(!0),i(A,null,T(c.columns,e=>(n(),b(f(ie),{key:e.key,item:e,onColumnWidthUpdated:C=>m("columnWidthUpdated",e)},{default:d(()=>[e.key=="_liked_by"?(n(),b(l,{key:0,variant:"ghosted",class:D(["!h-4",s.value?"fill-red-500":"fill-white"]),onClick:t[0]||(t[0]=()=>m("applyLikeFilter"))},{default:d(()=>[r(O,{class:"h-4 w-4"})]),_:1},8,["class"])):L("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),r(f(ue),{class:"mx-3 sm:mx-5",id:"list-rows"},{default:d(()=>[(n(!0),i(A,null,T(c.rows,e=>(n(),b(f(de),{key:e.name,row:e},{default:d(({idx:C,column:g,item:p})=>[r(f(ce),{item:p},{prefix:d(()=>[["caller","receiver"].includes(g.key)?(n(),i("div",$e,[p.label?(n(),b(f(H),{key:0,class:"flex items-center",image:p.image,label:p.label,size:"sm"},null,8,["image","label"])):L("",!0)])):["type","duration"].includes(g.key)?(n(),i("div",Ve,[r(a,{name:p.icon,class:"h-3 w-3"},null,8,["name"])])):L("",!0)]),default:d(({label:B})=>[["modified","creation"].includes(g.key)?(n(),i("div",{key:0,class:"truncate text-base",onClick:$=>m("applyFilter",{event:$,idx:C,column:g,item:p,firstColumn:c.columns[0]})},[r(f(q),{text:p.label},{default:d(()=>[v("div",null,V(p.timeAgo),1)]),_:2},1032,["text"])],8,Me)):g.key==="status"?(n(),i("div",Ue,[r(F,{variant:"subtle",theme:p.color,size:"md",label:o.__(p.label),onClick:$=>m("applyFilter",{event:$,idx:C,column:g,item:p,firstColumn:c.columns[0]})},null,8,["theme","label","onClick"])])):g.type==="Check"?(n(),i("div",Fe,[r(M,{type:"checkbox",modelValue:p,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):g.key==="_liked_by"?(n(),i("div",Ie,[g.key=="_liked_by"?(n(),b(l,{key:0,variant:"ghosted",class:D(x(p)?"fill-red-500":"fill-white"),onClick:ee(()=>m("likeDoc",{name:e.name,liked:x(p)}),["stop","prevent"])},{default:d(()=>[r(O,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):L("",!0)])):(n(),i("div",{key:4,class:"truncate text-base",onClick:$=>m("applyFilter",{event:$,idx:C,column:g,item:p,firstColumn:c.columns[0]})},V(B),9,Ae))]),_:2},1032,["item"])]),_:2},1032,["row"]))),128))]),_:1}),r(f(me),null,{actions:d(({selections:e,unselectAll:C})=>[r(f(_e),{options:_.value.bulkActions(e,C)},{default:d(()=>[r(l,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},16,["columns","rows","options"]),r(f(fe),{class:"border-t sm:px-5 px-3 py-2",modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=e=>h.value=e),options:{rowCount:c.options.rowCount,totalCount:c.options.totalCount},onLoadMore:t[3]||(t[3]=e=>m("loadMore"))},null,8,["modelValue","options"]),r(ve,{ref_key:"listBulkActionsRef",ref:_,modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=e=>y.value=e),doctype:"CRM Call Log",options:{hideEdit:!0,hideAssign:!0}},null,8,["modelValue"])],64)}}},ze={},De={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ne=v("g",{"clip-path":"url(#clip0_3668_69185)"},[v("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),Pe=v("defs",null,[v("clipPath",{id:"clip0_3668_69185"},[v("rect",{width:"16",height:"16",fill:"white"})])],-1),Re=[Ne,Pe];function Te(c,w){return n(),i("svg",De,Re)}const He=E(ze,[["render",Te]]);const Se={class:"flex items-center gap-3"},We={class:"text-2xl font-semibold leading-6 text-gray-900"},Oe={class:"flex flex-col gap-3.5"},je={class:"grid size-7 place-content-center"},Ee={class:"flex min-h-7 w-full items-center gap-2"},qe={key:0,class:"flex items-center gap-1"},Ze={class:"ml-1 flex flex-col gap-1"},Je={class:"ml-1 flex flex-col gap-1"},Ge={key:2,class:"w-full"},Ke=["src"],Qe=["innerHTML"],Xe=["innerHTML"],Ye={key:5},el={__name:"CallLogModal",props:P({name:{type:String,default:{}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const w=c,u=R(c,"modelValue"),m=k(!1),h=oe(),y=k(null),s=k({}),U=z(()=>{var o;return s.value.doc?[{icon:S(N,{name:s.value.doc.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:s.value.doc.type.label+" Call"},{icon:Ce,name:"receiver",value:{receiver:s.value.doc.receiver,caller:s.value.doc.caller}},{icon:s.value.doc.reference_doctype=="Lead"?ke:he,name:"reference_doctype",value:s.value.doc.reference_doctype=="Lead"?"Lead":"Opportunity",link:()=>{s.value.doc.reference_doctype=="Lead"?h.push({name:"Lead",params:{leadId:s.value.doc.reference_docname}}):h.push({name:"Opportunity",params:{opportunityId:s.value.doc.reference_docname}})},condition:()=>s.value.doc.reference_docname},{icon:we,name:"creation",value:s.value.doc.creation.label,tooltip:s.value.doc.creation.label},{icon:ye,name:"duration",value:s.value.doc.duration.label},{icon:He,name:"status",value:s.value.doc.status.label,color:s.value.doc.status.color},{icon:S(N,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:s.value.doc.recording_url},{icon:be,name:"note",value:(o=y.value)==null?void 0:o.doc}].filter(t=>t.value).filter(t=>t.condition?t.condition():!0):[]});function x(){se("next_crm.ncrm.doctype.crm_call_log.crm_call_log.create_lead_from_call_log",{call_log:s.value.doc}).then(_=>{_&&h.push({name:"Lead",params:{leadId:_}})})}return j(u,_=>{_&&(s.value=W({doctype:"CRM Call Log",name:w.name,fields:["name","caller","receiver","duration","type","status","from","to","note","recording_url","reference_doctype","reference_docname","creation"],cache:["call_log",w.name],auto:!0,transform:o=>{for(const t in o)o[t]=Z(t,o);return o},onSuccess:o=>{if(!o.note){y.value=null;return}y.value=W({doctype:"NCRM Note",name:o.note,fields:["title","content"],cache:["note",o.note],auto:!0})}}))}),(_,o)=>{var a,F,M;const t=I("Button"),l=I("Dialog");return n(),i(A,null,[r(l,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=e=>u.value=e)},te({"body-title":d(()=>[v("div",Se,[v("h3",We,V(_.__("Call Details")),1)])]),"body-content":d(()=>[v("div",Oe,[(n(!0),i(A,null,T(U.value,e=>(n(),i("div",{key:e.name,class:"flex gap-2 text-base text-gray-800"},[v("div",je,[(n(),b(ae(e.icon)))]),v("div",Ee,[e.name=="receiver"?(n(),i("div",qe,[r(f(H),{image:e.value.caller.image,label:e.value.caller.label,size:"sm"},null,8,["image","label"]),v("div",Ze,V(e.value.caller.label),1),r(f(N),{name:"arrow-right",class:"mx-1 h-4 w-4 text-gray-600"}),r(f(H),{image:e.value.receiver.image,label:e.value.receiver.label,size:"sm"},null,8,["image","label"]),v("div",Je,V(e.value.receiver.label),1)])):e.tooltip?(n(),b(f(q),{key:1,text:e.tooltip},{default:d(()=>[ne(V(e.value),1)]),_:2},1032,["text"])):e.name=="recording_url"?(n(),i("div",Ge,[v("audio",{class:"audio-control w-full",controls:"",src:e.value},null,8,Ke)])):e.name=="note"?(n(),i("div",{key:3,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-gray-700",onClick:o[0]||(o[0]=()=>m.value=!0)},[r(xe,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:d(()=>{var C,g,p,B,$;return[(C=e.value)!=null&&C.title?(n(),i("div",{key:0,class:D([(g=e.value)!=null&&g.content?"mb-1 font-bold":""]),innerHTML:(p=e.value)==null?void 0:p.title},null,10,Qe)):L("",!0),(B=e.value)!=null&&B.content?(n(),i("div",{key:1,innerHTML:($=e.value)==null?void 0:$.content},null,8,Xe)):L("",!0)]}),_:2},1024)])):(n(),i("div",{key:4,class:D(e.color?`text-${e.color}-600`:"")},V(e.value),3)),e.link?(n(),i("div",Ye,[r(ge,{class:"h-4 w-4 shrink-0 cursor-pointer text-gray-600 hover:text-gray-800",onClick:()=>e.link()},null,8,["onClick"])])):L("",!0)])]))),128))])]),_:2},[((a=s.value.doc)==null?void 0:a.type.label)=="Incoming"&&!((F=s.value.doc)!=null&&F.reference_docname)?{name:"actions",fn:d(()=>[r(t,{class:"w-full",variant:"solid",label:_.__("Create lead"),onClick:x},null,8,["label"])]),key:"0"}:void 0]),1032,["modelValue"]),r(Le,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=e=>m.value=e),note:(M=y.value)==null?void 0:M.doc},null,8,["modelValue","note"])],64)}}},ll=E(el,[["__scopeId","data-v-bbab6654"]]),ol={key:1,class:"flex h-full items-center justify-center"},tl={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},Fl={__name:"CallLogs",setup(c){const w=k(null),u=k({}),m=k(1),h=k(1),y=k(20),s=k(null),U=z(()=>{var t,l,a;return!((l=(t=u.value)==null?void 0:t.data)!=null&&l.data)||!["list","group_by"].includes(u.value.data.view_type)?[]:(a=u.value)==null?void 0:a.data.data.map(F=>{var e;let M={};return(e=u.value)==null||e.data.rows.forEach(C=>{M[C]=Z(C,F)}),M})}),x=k(!1),_=k(null);function o(t){_.value=t,x.value=!0}return(t,l)=>(n(),i(A,null,[r(X,null,{"left-header":d(()=>[r(G,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=a=>s.value=a),routeName:"Call Logs"},null,8,["modelValue"])]),"right-header":d(()=>{var a;return[(a=w.value)!=null&&a.customListActions?(n(),b(K,{key:0,actions:w.value.customListActions},null,8,["actions"])):L("",!0)]}),_:1}),r(J,{ref_key:"viewControls",ref:s,modelValue:u.value,"onUpdate:modelValue":l[1]||(l[1]=a=>u.value=a),loadMore:m.value,"onUpdate:loadMore":l[2]||(l[2]=a=>m.value=a),resizeColumn:h.value,"onUpdate:resizeColumn":l[3]||(l[3]=a=>h.value=a),updatedPageCount:y.value,"onUpdate:updatedPageCount":l[4]||(l[4]=a=>y.value=a),doctype:"CRM Call Log"},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),u.value.data&&U.value.length?(n(),b(Be,{key:0,ref_key:"callLogsListView",ref:w,modelValue:u.value.data.page_length_count,"onUpdate:modelValue":l[5]||(l[5]=a=>u.value.data.page_length_count=a),list:u.value,"onUpdate:list":l[6]||(l[6]=a=>u.value=a),rows:U.value,columns:u.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:u.value.data.row_count,totalCount:u.value.data.total_count},onShowCallLog:o,onLoadMore:l[7]||(l[7]=()=>m.value++),onColumnWidthUpdated:l[8]||(l[8]=()=>h.value++),onUpdatePageCount:l[9]||(l[9]=a=>y.value=a),onApplyFilter:l[10]||(l[10]=a=>s.value.applyFilter(a)),onApplyLikeFilter:l[11]||(l[11]=a=>s.value.applyLikeFilter(a)),onLikeDoc:l[12]||(l[12]=a=>s.value.likeDoc(a))},null,8,["modelValue","list","rows","columns","options"])):u.value.data?(n(),i("div",ol,[v("div",tl,[r(Q,{class:"h-10 w-10"}),v("span",null,V(t.__("No {0} Found",[t.__("Logs")])),1)])])):L("",!0),r(ll,{modelValue:x.value,"onUpdate:modelValue":l[13]||(l[13]=a=>x.value=a),name:_.value},null,8,["modelValue","name"])],64))}};export{Fl as default};
//# sourceMappingURL=CallLogs-d6e3f826.js.map
