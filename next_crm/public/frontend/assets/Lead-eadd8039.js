import{a as Ce}from"./FadedScrollableDiv-10ee6cf2.js";import{_ as we,a as he}from"./SidePanelModal-7a4a2300.js";import{E as ke,_ as Q}from"./views-5d4a0486.js";import{u as Ve,_ as Ie,A as Le,E as $e,a as X,b as Ue,S as Ee}from"./useActiveTabManager-3d8e42db.js";import{E as Ae}from"./Email2Icon-08867043.js";import{C as Se}from"./CommentIcon-0a334634.js";import{P as Y}from"./PhoneIcon-42af6989.js";import{T as Te}from"./TaskIcon-1948830b.js";import{N as Ne}from"./NoteModal-6fe04093.js";import{W as ze}from"./WhatsAppIcon-1b004e01.js";import{I as Me}from"./IndicatorIcon-367a8d49.js";import{C as je}from"./CameraIcon-91addc5f.js";import{L as qe}from"./LinkIcon-9e12ceb6.js";import{C as Fe}from"./CustomersIcon-c98fca89.js";import{C as Be}from"./ContactsIcon-a70cc581.js";import{_ as Oe}from"./LayoutHeader-72a3cdee.js";import{_ as Pe}from"./AssignmentModal-759f92c3.js";import{s as Re,_ as De}from"./statuses-6fc48ca5.js";import{_ as We}from"./Section-3c95fd43.js";import{g as Ge,_ as Je,S as Ke}from"./view-43ec0067.js";import{_ as He}from"./CustomActions-d5b79d4f.js";import{g as Qe,u as Xe,e as k,s as Ye,i as Ze,j as ea,b as aa,_ as U,k as O,o as ta}from"./index-b1bb6af7.js";import{c as sa}from"./contacts-690888e4.js";import{c as Z,w as oa}from"./settings-9f3d7d3a.js";import{h as la,v as na,l as p,x as P,I as R,a as ia,j as ee,K as ra,k as da,r as z,b as r,c as y,u as a,g as c,w as n,p as _,d as l,M as D,F as ae,z as ua,G as te,n as se,e as u,t as b,C as ma,f as pa,E as ca}from"./index-8ca2d158.js";import{_ as _a}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-28c0bac8.js";import{_ as oe}from"./Dropdown.vue_vue_type_script_setup_true_lang-dba778cd.js";import{F as fa}from"./FileUploader-e5eb09df.js";import{_ as le}from"./Switch.vue_vue_type_script_setup_true_lang-cbc97d13.js";import"./DragVerticalIcon-523c4542.js";import"./CalendarIcon-6dc7ec06.js";import"./callLog-6b45f0c6.js";import"./IconPicker-b2d84813.js";import"./LeadsIcon-81572691.js";import"./OpportunitiesIcon-89f01f41.js";import"./EmailTemplateModal-9a3ef12a.js";import"./TaskModal-9393661c.js";import"./ArrowUpRightIcon-c299f2a1.js";const va={key:1,class:"flex h-full overflow-hidden"},ba={class:"flex items-center justify-start gap-5 border-b p-5"},ga={class:"group relative size-12"},ya={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},xa={class:"flex flex-col gap-2.5 truncate"},Ca={class:"truncate text-2xl font-medium"},wa={class:"flex gap-1.5"},ha={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},ka={class:"flex flex-col overflow-y-auto"},Va={class:"mb-4 flex items-center gap-2 text-gray-600"},Ia={class:"block text-base"},La={class:"ml-6"},$a={class:"flex items-center justify-between text-base"},Ua={key:1,class:"mt-2.5 text-base"},Ea={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},Aa={class:"block text-base"},Sa={class:"ml-6"},Ta={class:"flex items-center justify-between text-base"},Na={key:1,class:"mt-2.5 text-base"},yt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(ne){const{$dialog:ie,$socket:re,makeCall:de}=Qe(),{getContactByName:V,contacts:ue}=sa(),{statusOptions:me,getLeadStatus:pe}=Re(),{isManager:ce}=Xe(),v=la(),M=na(),I=ne,j=p([]),W=p([]),t=P({url:"/api/method/next_crm.api.lead.get_lead",params:{name:I.leadId},cache:["lead",I.leadId],onSuccess:async s=>{let e={doc:s,$dialog:ie,$socket:re,router:M,updateField:C,createToast:k,deleteDoc:ge,resource:{lead:t,fieldsLayout:x},call:R};Ye(s);let i=await Ze(s,e);j.value=i.actions||[],W.value=i.statuses||[]}});ia(()=>{t.data||t.fetch()});const q=p(!1),E=p(!1),A=p(!1),F=p(!1);function G(s,e,i){e=Array.isArray(s)?"":e,!(!Array.isArray(s)&&_e(s,e))&&P({url:"frappe.client.set_value",params:{doctype:"Lead",name:I.leadId,fieldname:s,value:e},auto:!0,onSuccess:()=>{t.reload(),q.value=!0,k({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),i==null||i()},onError:m=>{var N;k({title:__("Error updating lead"),text:__((N=m.messages)==null?void 0:N[0]),icon:"x",iconClasses:"text-red-600"})}})}function _e(s,e){var m;let i=t.data.fields_meta||{};return(m=i[s])!=null&&m.reqd&&!e?(k({title:__("Error Updating Lead"),text:__("{0} is a required field",[i[s].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const fe=ee(()=>{let s=[{label:__("Leads"),route:{name:"Leads"}}];if(v.query.view||v.query.viewType){let e=Ge(v.query.view,v.query.viewType,"Lead");e&&s.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:v.query.viewType},query:{view:v.query.view}}})}return s.push({label:t.data.lead_name||__("Untitled"),route:{name:"Lead",params:{leadId:t.data.name}}}),s});ra(()=>{var s,e;return{title:((s=t.data)==null?void 0:s.lead_name)||((e=t.data)==null?void 0:e.name)}});const S=ee(()=>[{name:"Activity",label:__("Activity"),icon:Le},{name:"Emails",label:__("Emails"),icon:$e},{name:"Comments",label:__("Comments"),icon:Se},{name:"Calls",label:__("Calls"),icon:Y,condition:()=>Z.value},{name:"Tasks",label:__("Tasks"),icon:Te},{name:"Notes",label:__("Notes"),icon:Ne},{name:"Attachments",label:__("Attachments"),icon:X},{name:"WhatsApp",label:__("WhatsApp"),icon:ze,condition:()=>oa.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:g,changeTabTo:ve}=Ve(S,"lastLeadTab");da(S,s=>{if(s&&v.params.tabName){let e=s.findIndex(i=>i.name.toLowerCase()===v.params.tabName.toLowerCase());e!==-1&&(g.value=e)}});function be(s){let e=s.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const x=P({url:"next_crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",I.leadId],params:{doctype:"Lead",name:I.leadId},auto:!0});function C(s,e,i){G(s,e,()=>{t.data[s]=e,i==null||i()})}async function ge(s){await R("frappe.client.delete",{doctype:"Lead",name:s}),M.push({name:"Leads"})}const T=p(!1),w=p(!1),h=p(!1),f=p(""),L=p("");async function J(s){let e=!1;if(w.value&&!f.value){k({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(h.value&&!L.value){k({title:__("Error"),text:__("Please select an existing customer"),icon:"x",iconClasses:"text-red-600"});return}if(w.value&&f.value&&(t.data.salutation=V(f.value).salutation,t.data.first_name=V(f.value).first_name,t.data.last_name=V(f.value).last_name,t.data.email_id=V(f.value).email_id,t.data.mobile_no=V(f.value).mobile_no,w.value=!1,e=!0),h.value&&L.value&&(t.data.customer=L.value,h.value=!1,e=!0),e)G({salutation:t.data.salutation,first_name:t.data.first_name,last_name:t.data.last_name,email_id:t.data.email_id,mobile_no:t.data.mobile_no,customer:t.data.customer},"",()=>J(!0)),T.value=!1;else{let i=await R("next_crm.overrides.lead.convert_to_opportunity",{lead:t.data.name});i&&(ua("convert_lead_to_opportunity"),s&&await ue.reload(),M.push({name:"Opportunity",params:{opportunityId:i}}))}}const B=p(null);function ye(){B.value.emailBox.show=!0}return(s,e)=>{var K,H;const i=z("FeatherIcon"),m=z("Button"),N=z("ErrorMessage"),xe=z("Dialog");return r(),y(ae,null,[a(t).data?(r(),c(Oe,{key:0},{"left-header":n(()=>[l(a(_a),{items:fe.value},{prefix:n(({item:o})=>[o.icon?(r(),c(Ce,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):_("",!0)]),_:1},8,["items"])]),"right-header":n(()=>{var o;return[j.value?(r(),c(He,{key:0,actions:j.value},null,8,["actions"])):_("",!0),(r(),c(te(((o=a(t).data._assignedTo)==null?void 0:o.length)==1?"Button":"div"),null,{default:n(()=>[l(De,{avatars:a(t).data._assignedTo,onClick:e[0]||(e[0]=d=>E.value=!0)},null,8,["avatars"])]),_:1})),l(a(oe),{options:a(me)("lead",C,W.value)},{default:n(({open:d})=>[l(m,{label:a(t).data.status,class:se(a(pe)(a(t).data.status).colorClass)},{prefix:n(()=>[l(Me)]),suffix:n(()=>[l(i,{name:d?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"]),l(m,{label:s.__("Convert to Opportunity"),variant:"solid",onClick:e[1]||(e[1]=d=>T.value=!0)},null,8,["label"])]}),_:1})):_("",!0),(K=a(t))!=null&&K.data?(r(),y("div",va,[l(a(Je),{modelValue:a(g),"onUpdate:modelValue":e[5]||(e[5]=o=>D(g)?g.value=o:null),tabs:S.value},{default:n(({tab:o})=>[l(Ue,{ref_key:"activities",ref:B,doctype:"Lead",tabs:S.value,reload:q.value,"onUpdate:reload":e[2]||(e[2]=d=>q.value=d),tabIndex:a(g),"onUpdate:tabIndex":e[3]||(e[3]=d=>D(g)?g.value=d:null),modelValue:a(t),"onUpdate:modelValue":e[4]||(e[4]=d=>D(t)?t.value=d:null)},null,8,["tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),l(we,{class:"flex flex-col justify-between border-l",side:"right"},{default:n(()=>[u("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[6]||(e[6]=o=>a(ea)(a(t).data.name))},b(s.__(a(t).data.name)),1),l(a(fa),{onSuccess:e[11]||(e[11]=o=>C("image",o.file_url)),validateFile:be},{default:n(({openFileSelector:o,error:d})=>[u("div",ba,[u("div",ga,[l(a(aa),{size:"3xl",class:"size-12",label:a(t).data.first_name||s.__("Untitled"),image:a(t).data.image},null,8,["label","image"]),(r(),c(te(a(t).data.image?a(oe):"div"),ma(a(t).data.image?{options:[{icon:"upload",label:a(t).data.image?s.__("Change image"):s.__("Upload image"),onClick:o},{icon:"trash-2",label:s.__("Remove image"),onClick:()=>C("image","")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:n(()=>[u("div",ya,[l(je,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),u("div",xa,[l(a(U),{text:a(t).data.lead_name||s.__("Set first name")},{default:n(()=>[u("div",Ca,b(a(t).data.lead_name||s.__("Untitled")),1)]),_:1},8,["text"]),u("div",wa,[a(Z)?(r(),c(a(U),{key:0,text:s.__("Make a call")},{default:n(()=>[l(m,{class:"h-7 w-7",onClick:e[7]||(e[7]=()=>a(t).data.mobile_no?a(de)(a(t).data.mobile_no):a(O)(s.__("No phone number set")))},{default:n(()=>[l(Y,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])):_("",!0),l(a(U),{text:s.__("Send an email")},{default:n(()=>[l(m,{class:"h-7 w-7"},{default:n(()=>[l(Ae,{class:"h-4 w-4",onClick:e[8]||(e[8]=$=>a(t).data.email?ye():a(O)(s.__("No email set")))})]),_:1})]),_:1},8,["text"]),l(a(U),{text:s.__("Go to website")},{default:n(()=>[l(m,{class:"h-7 w-7"},{default:n(()=>[l(qe,{class:"h-4 w-4",onClick:e[9]||(e[9]=$=>a(t).data.website?a(ta)(a(t).data.website):a(O)(s.__("No website set")))})]),_:1})]),_:1},8,["text"]),l(a(U),{text:s.__("Attach a file")},{default:n(()=>[l(m,{class:"h-7 w-7",onClick:e[10]||(e[10]=$=>F.value=!0)},{default:n(()=>[l(X,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])]),l(N,{message:s.__(d)},null,8,["message"])])])]),_:1}),a(t).data.sla_status?(r(),c(Ee,{key:0,modelValue:a(t).data,"onUpdate:modelValue":e[12]||(e[12]=o=>a(t).data=o),onUpdateField:C},null,8,["modelValue"])):_("",!0),a(x).data?(r(),y("div",ha,[u("div",ka,[(r(!0),y(ae,null,pa(a(x).data,(o,d)=>(r(),y("div",{key:o.label,class:se(["flex flex-col p-3",{"border-b":d!==a(x).data.length-1}])},[l(We,{"is-opened":o.opened,label:o.label},ca({default:n(()=>[l(Ke,{fields:o.fields,isLastSection:d==a(x).data.length-1,modelValue:a(t).data,"onUpdate:modelValue":e[13]||(e[13]=$=>a(t).data=$),onUpdate:C},null,8,["fields","isLastSection","modelValue"])]),_:2},[d==0&&a(ce)()?{name:"actions",fn:n(()=>[l(m,{variant:"ghost",class:"w-7 mr-2",onClick:e[14]||(e[14]=$=>A.value=!0)},{default:n(()=>[l(ke,{class:"h-4 w-4"})]),_:1})]),key:"0"}:void 0]),1032,["is-opened","label"])],2))),128))])])):_("",!0)]),_:1})])):_("",!0),E.value?(r(),c(Pe,{key:2,modelValue:E.value,"onUpdate:modelValue":e[15]||(e[15]=o=>E.value=o),assignees:a(t).data._assignedTo,"onUpdate:assignees":e[16]||(e[16]=o=>a(t).data._assignedTo=o),doc:a(t).data,doctype:"Lead"},null,8,["modelValue","assignees","doc"])):_("",!0),l(xe,{modelValue:T.value,"onUpdate:modelValue":e[21]||(e[21]=o=>T.value=o),options:{title:s.__("Convert to Opportunity"),size:"xl",actions:[{label:s.__("Convert"),variant:"solid",onClick:J}]}},{"body-content":n(()=>[u("div",Va,[l(Fe,{class:"h-4 w-4"}),u("label",Ia,b(s.__("Customer")),1)]),u("div",La,[u("div",$a,[u("div",null,b(s.__("Choose Existing")),1),l(a(le),{modelValue:h.value,"onUpdate:modelValue":e[17]||(e[17]=o=>h.value=o)},null,8,["modelValue"])]),h.value?(r(),c(Q,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:L.value,doctype:"Customer",onChange:e[18]||(e[18]=o=>L.value=o)},null,8,["value"])):(r(),y("div",Ua,b(s.__("New customer will be created based on the data in details section")),1))]),u("div",Ea,[l(Be,{class:"h-4 w-4"}),u("label",Aa,b(s.__("Contact")),1)]),u("div",Sa,[u("div",Ta,[u("div",null,b(s.__("Choose Existing")),1),l(a(le),{modelValue:w.value,"onUpdate:modelValue":e[19]||(e[19]=o=>w.value=o)},null,8,["modelValue"])]),w.value?(r(),c(Q,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:f.value,doctype:"Contact",onChange:e[20]||(e[20]=o=>f.value=o)},null,8,["value"])):(r(),y("div",Na,b(s.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"]),A.value?(r(),c(he,{key:3,modelValue:A.value,"onUpdate:modelValue":e[22]||(e[22]=o=>A.value=o),onReload:e[23]||(e[23]=()=>a(x).reload())},null,8,["modelValue"])):_("",!0),(H=a(t).data)!=null&&H.name?(r(),c(Ie,{key:4,modelValue:F.value,"onUpdate:modelValue":e[24]||(e[24]=o=>F.value=o),doctype:"Lead",docname:a(t).data.name,onAfter:e[25]||(e[25]=()=>{var o,d;(d=(o=B.value)==null?void 0:o.all_activities)==null||d.reload(),a(ve)("attachments")})},null,8,["modelValue","docname"])):_("",!0)],64)}}};export{yt as default};
//# sourceMappingURL=Lead-eadd8039.js.map
